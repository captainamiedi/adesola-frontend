(self.webpackChunkadesola_frontend=self.webpackChunkadesola_frontend||[]).push([[90],{6090:function(e,t,r){"use strict";r.d(t,{eI:function(){return Nt}});var n=r(4165),s=r(5671),i=r(3144),a=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},o=r(7326),c=r(136),u=r(7277),h=r(1120);var l=r(4942);function d(e,t,r,n){return d="undefined"!==typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var s,i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,h.Z)(e)););return e}(e,t);if(i){if((s=Object.getOwnPropertyDescriptor(i,t)).set)return s.set.call(n,r),!0;if(!s.writable)return!1}if(s=Object.getOwnPropertyDescriptor(n,t)){if(!s.writable)return!1;s.value=r,Object.defineProperty(n,t,s)}else(0,l.Z)(n,t,r);return!0},d(e,t,r,n)}var f,v,p,b,y,m=r(8737),k=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FunctionsError",c=arguments.length>2?arguments[2]:void 0;return(0,s.Z)(this,r),i=t.call(this,e),function(e,t,r,n,s){if(!d(e,t,r,n||e)&&s)throw new TypeError("failed to set property")}((n=(0,o.Z)(i),(0,h.Z)(r.prototype)),"name",a,n,!0),i.context=c,i}return(0,i.Z)(r)}((0,m.Z)(Error)),g=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e){return(0,s.Z)(this,r),t.call(this,"Failed to send a request to the Edge Function","FunctionsFetchError",e)}return(0,i.Z)(r)}(k),w=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e){return(0,s.Z)(this,r),t.call(this,"Relay Error invoking the Edge Function","FunctionsRelayError",e)}return(0,i.Z)(r)}(k),x=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e){return(0,s.Z)(this,r),t.call(this,"Edge Function returned a non-2xx status code","FunctionsHttpError",e)}return(0,i.Z)(r)}(k),_=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},Z=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.headers,c=void 0===o?{}:o,u=i.customFetch;(0,s.Z)(this,e),this.url=t,this.headers=c,this.fetch=function(e){var t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return a(void 0,void 0,void 0,(0,n.Z)().mark((function e(){var s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.t.bind(r,4255,23));case 2:return e.next=4,(s=e.sent).fetch.apply(s,t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))}:fetch),function(){return t.apply(void 0,arguments)}}(u)}return(0,i.Z)(e,[{key:"setAuth",value:function(e){this.headers.Authorization="Bearer ".concat(e)}},{key:"invoke",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _(this,void 0,void 0,(0,n.Z)().mark((function s(){var i,a,o,c,u,h,l,d,f;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,i=r.headers,a=r.method,o=r.body,c={},o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&("undefined"!==typeof Blob&&o instanceof Blob||o instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",u=o):"string"===typeof o?(c["Content-Type"]="text/plain",u=o):"undefined"!==typeof FormData&&o instanceof FormData?u=o:(c["Content-Type"]="application/json",u=JSON.stringify(o))),n.next=6,this.fetch("".concat(this.url,"/").concat(e),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),i),body:u}).catch((function(e){throw new g(e)}));case 6:if(h=n.sent,!(l=h.headers.get("x-relay-error"))||"true"!==l){n.next=10;break}throw new w(h);case 10:if(h.ok){n.next=12;break}throw new x(h);case 12:if("application/json"!==(d=(null!==(t=h.headers.get("Content-Type"))&&void 0!==t?t:"text/plain").split(";")[0].trim())){n.next=19;break}return n.next=16,h.json();case 16:f=n.sent,n.next=34;break;case 19:if("application/octet-stream"!==d){n.next=25;break}return n.next=22,h.blob();case 22:f=n.sent,n.next=34;break;case 25:if("multipart/form-data"!==d){n.next=31;break}return n.next=28,h.formData();case 28:f=n.sent,n.next=34;break;case 31:return n.next=33,h.text();case 33:f=n.sent;case 34:return n.abrupt("return",{data:f,error:null});case 37:return n.prev=37,n.t0=n.catch(0),n.abrupt("return",{data:null,error:n.t0});case 40:case"end":return n.stop()}}),s,this,[[0,37]])})))}}]),e}(),T=r(9439),S=r(3433),O=r(5861),E=r(4255),j=r.n(E),P=function(){function e(t){(0,s.Z)(this,e),this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:"undefined"===typeof fetch?this.fetch=j():this.fetch=fetch}return(0,i.Z)(e,[{key:"throwOnError",value:function(){return this.shouldThrowOnError=!0,this}},{key:"then",value:function(e,t){var r=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");var s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(function(){var e=(0,O.Z)((0,n.Z)().mark((function e(t){var s,i,a,o,c,u,h,l,d,f,v,p,b;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=null,c=null,u=null,h=t.status,l=t.statusText,!t.ok){e.next=17;break}if("HEAD"===r.method){e.next=11;break}return e.next=9,t.text();case 9:""===(d=e.sent)||(c="text/csv"===r.headers.Accept||r.headers.Accept&&r.headers.Accept.includes("application/vnd.pgrst.plan+text")?d:JSON.parse(d));case 11:f=null===(s=r.headers.Prefer)||void 0===s?void 0:s.match(/count=(exact|planned|estimated)/),v=null===(i=t.headers.get("content-range"))||void 0===i?void 0:i.split("/"),f&&v&&v.length>1&&(u=parseInt(v[1])),r.isMaybeSingle&&"GET"===r.method&&Array.isArray(c)&&(c.length>1?(o={code:"PGRST116",details:"Results contain ".concat(c.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,u=null,h=406,l="Not Acceptable"):c=1===c.length?c[0]:null),e.next=24;break;case 17:return e.next=19,t.text();case 19:p=e.sent;try{o=JSON.parse(p),Array.isArray(o)&&404===t.status&&(c=[],o=null,h=200,l="OK")}catch(n){404===t.status&&""===p?(h=204,l="No Content"):o={message:p}}if(o&&r.isMaybeSingle&&(null===(a=null===o||void 0===o?void 0:o.details)||void 0===a?void 0:a.includes("Results contain 0 rows"))&&(o=null,h=200,l="OK"),!o||!r.shouldThrowOnError){e.next=24;break}throw o;case 24:return b={error:o,data:c,count:u,status:h,statusText:l},e.abrupt("return",b);case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());return this.shouldThrowOnError||(s=s.catch((function(e){var t,r,n;return{error:{message:"".concat(null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:"FetchError",": ").concat(null===e||void 0===e?void 0:e.message),details:"".concat(null!==(r=null===e||void 0===e?void 0:e.stack)&&void 0!==r?r:""),hint:"",code:"".concat(null!==(n=null===e||void 0===e?void 0:e.code)&&void 0!==n?n:"")},data:null,count:null,status:0,statusText:""}}))),s.then(e,t)}}]),e}(),A=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"select",value:function(e){var t=!1,r=(null!==e&&void 0!==e?e:"*").split("").map((function(e){return/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)})).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}},{key:"order",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.ascending,n=void 0===r||r,s=t.nullsFirst,i=t.foreignTable,a=i?"".concat(i,".order"):"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,"".concat(o?"".concat(o,","):"").concat(e,".").concat(n?"asc":"desc").concat(void 0===s?"":s?".nullsfirst":".nullslast")),this}},{key:"limit",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).foreignTable,r="undefined"===typeof t?"limit":"".concat(t,".limit");return this.url.searchParams.set(r,"".concat(e)),this}},{key:"range",value:function(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).foreignTable,n="undefined"===typeof r?"offset":"".concat(r,".offset"),s="undefined"===typeof r?"limit":"".concat(r,".limit");return this.url.searchParams.set(n,"".concat(e)),this.url.searchParams.set(s,"".concat(t-e+1)),this}},{key:"abortSignal",value:function(e){return this.signal=e,this}},{key:"single",value:function(){return this.headers.Accept="application/vnd.pgrst.object+json",this}},{key:"maybeSingle",value:function(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}},{key:"csv",value:function(){return this.headers.Accept="text/csv",this}},{key:"geojson",value:function(){return this.headers.Accept="application/geo+json",this}},{key:"explain",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.analyze,r=void 0!==t&&t,n=e.verbose,s=void 0!==n&&n,i=e.settings,a=void 0!==i&&i,o=e.buffers,c=void 0!==o&&o,u=e.wal,h=void 0!==u&&u,l=e.format,d=void 0===l?"text":l,f=[r?"analyze":null,s?"verbose":null,a?"settings":null,c?"buffers":null,h?"wal":null].filter(Boolean).join("|"),v=this.headers.Accept;return this.headers.Accept="application/vnd.pgrst.plan+".concat(d,'; for="').concat(v,'"; options=').concat(f,";"),this}},{key:"rollback",value:function(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}},{key:"returns",value:function(){return this}}]),r}(P),C=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"eq",value:function(e,t){return this.url.searchParams.append(e,"eq.".concat(t)),this}},{key:"neq",value:function(e,t){return this.url.searchParams.append(e,"neq.".concat(t)),this}},{key:"gt",value:function(e,t){return this.url.searchParams.append(e,"gt.".concat(t)),this}},{key:"gte",value:function(e,t){return this.url.searchParams.append(e,"gte.".concat(t)),this}},{key:"lt",value:function(e,t){return this.url.searchParams.append(e,"lt.".concat(t)),this}},{key:"lte",value:function(e,t){return this.url.searchParams.append(e,"lte.".concat(t)),this}},{key:"like",value:function(e,t){return this.url.searchParams.append(e,"like.".concat(t)),this}},{key:"likeAllOf",value:function(e,t){return this.url.searchParams.append(e,"like(all).{".concat(t.join(","),"}")),this}},{key:"likeAnyOf",value:function(e,t){return this.url.searchParams.append(e,"like(any).{".concat(t.join(","),"}")),this}},{key:"ilike",value:function(e,t){return this.url.searchParams.append(e,"ilike.".concat(t)),this}},{key:"ilikeAllOf",value:function(e,t){return this.url.searchParams.append(e,"ilike(all).{".concat(t.join(","),"}")),this}},{key:"ilikeAnyOf",value:function(e,t){return this.url.searchParams.append(e,"ilike(any).{".concat(t.join(","),"}")),this}},{key:"is",value:function(e,t){return this.url.searchParams.append(e,"is.".concat(t)),this}},{key:"in",value:function(e,t){var r=t.map((function(e){return"string"===typeof e&&new RegExp("[,()]").test(e)?'"'.concat(e,'"'):"".concat(e)})).join(",");return this.url.searchParams.append(e,"in.(".concat(r,")")),this}},{key:"contains",value:function(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cs.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cs.".concat(JSON.stringify(t))),this}},{key:"containedBy",value:function(e,t){return"string"===typeof t?this.url.searchParams.append(e,"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cd.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cd.".concat(JSON.stringify(t))),this}},{key:"rangeGt",value:function(e,t){return this.url.searchParams.append(e,"sr.".concat(t)),this}},{key:"rangeGte",value:function(e,t){return this.url.searchParams.append(e,"nxl.".concat(t)),this}},{key:"rangeLt",value:function(e,t){return this.url.searchParams.append(e,"sl.".concat(t)),this}},{key:"rangeLte",value:function(e,t){return this.url.searchParams.append(e,"nxr.".concat(t)),this}},{key:"rangeAdjacent",value:function(e,t){return this.url.searchParams.append(e,"adj.".concat(t)),this}},{key:"overlaps",value:function(e,t){return"string"===typeof t?this.url.searchParams.append(e,"ov.".concat(t)):this.url.searchParams.append(e,"ov.{".concat(t.join(","),"}")),this}},{key:"textSearch",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.config,s=r.type,i="";"plain"===s?i="pl":"phrase"===s?i="ph":"websearch"===s&&(i="w");var a=void 0===n?"":"(".concat(n,")");return this.url.searchParams.append(e,"".concat(i,"fts").concat(a,".").concat(t)),this}},{key:"match",value:function(e){var t=this;return Object.entries(e).forEach((function(e){var r=(0,T.Z)(e,2),n=r[0],s=r[1];t.url.searchParams.append(n,"eq.".concat(s))})),this}},{key:"not",value:function(e,t,r){return this.url.searchParams.append(e,"not.".concat(t,".").concat(r)),this}},{key:"or",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).foreignTable,r=t?"".concat(t,".or"):"or";return this.url.searchParams.append(r,"(".concat(e,")")),this}},{key:"filter",value:function(e,t,r){return this.url.searchParams.append(e,"".concat(t,".").concat(r)),this}}]),r}(A),R=function(){function e(t,r){var n=r.headers,i=void 0===n?{}:n,a=r.schema,o=r.fetch;(0,s.Z)(this,e),this.url=t,this.headers=i,this.schema=a,this.fetch=o}return(0,i.Z)(e,[{key:"select",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.head,n=void 0!==r&&r,s=t.count,i=n?"HEAD":"GET",a=!1,o=(null!==e&&void 0!==e?e:"*").split("").map((function(e){return/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e)})).join("");return this.url.searchParams.set("select",o),s&&(this.headers.Prefer="count=".concat(s)),new C({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}},{key:"insert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.count,n=t.defaultToNull,s=void 0===n||n,i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),r&&i.push("count=".concat(r)),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){var a=e.reduce((function(e,t){return e.concat(Object.keys(t))}),[]);if(a.length>0){var o=(0,S.Z)(new Set(a)).map((function(e){return'"'.concat(e,'"')}));this.url.searchParams.set("columns",o.join(","))}}return new C({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}},{key:"upsert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.onConflict,n=t.ignoreDuplicates,s=void 0!==n&&n,i=t.count,a=t.defaultToNull,o=void 0===a||a,c=["resolution=".concat(s?"ignore":"merge","-duplicates")];if(void 0!==r&&this.url.searchParams.set("on_conflict",r),this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push("count=".concat(i)),o||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(e)){var u=e.reduce((function(e,t){return e.concat(Object.keys(t))}),[]);if(u.length>0){var h=(0,S.Z)(new Set(u)).map((function(e){return'"'.concat(e,'"')}));this.url.searchParams.set("columns",h.join(","))}}return new C({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}},{key:"update",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).count,r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push("count=".concat(t)),this.headers.Prefer=r.join(","),new C({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}},{key:"delete",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).count,t=[];return e&&t.push("count=".concat(e)),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new C({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}]),e}(),I={"X-Client-Info":"postgrest-js/".concat("1.7.0")},U=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.headers,i=void 0===n?{}:n,a=r.schema,o=r.fetch;(0,s.Z)(this,e),this.url=t,this.headers=Object.assign(Object.assign({},I),i),this.schema=a,this.fetch=o}return(0,i.Z)(e,[{key:"from",value:function(e){var t=new URL("".concat(this.url,"/").concat(e));return new R(t,{headers:Object.assign({},this.headers),schema:this.schema,fetch:this.fetch})}},{key:"rpc",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=s.head,a=void 0!==i&&i,o=s.count,c=new URL("".concat(this.url,"/rpc/").concat(e));a?(t="HEAD",Object.entries(n).forEach((function(e){var t=(0,T.Z)(e,2),r=t[0],n=t[1];c.searchParams.append(r,"".concat(n))}))):(t="POST",r=n);var u=Object.assign({},this.headers);return o&&(u.Prefer="count=".concat(o)),new C({method:t,url:c,headers:u,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}}]),e}(),D=r(5087),N={"X-Client-Info":"realtime-js/".concat("2.7.2")};!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(f||(f={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(v||(v={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(p||(p={})),function(e){e.websocket="websocket"}(b||(b={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(y||(y={}));var L,B=function(){function e(t,r){(0,s.Z)(this,e),this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}return(0,i.Z)(e,[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer)}},{key:"scheduleTimeout",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout((function(){e.tries=e.tries+1,e.callback()}),this.timerCalc(this.tries+1))}}]),e}(),F=function(){function e(){(0,s.Z)(this,e),this.HEADER_LENGTH=1}return(0,i.Z)(e,[{key:"decode",value:function(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"===typeof e?JSON.parse(e):{})}},{key:"_binaryDecode",value:function(e){var t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}},{key:"_decodeBroadcast",value:function(e,t,r){var n=t.getUint8(1),s=t.getUint8(2),i=this.HEADER_LENGTH+2,a=r.decode(e.slice(i,i+n));i+=n;var o=r.decode(e.slice(i,i+s));return i+=s,{ref:null,topic:a,event:o,payload:JSON.parse(r.decode(e.slice(i,e.byteLength)))}}}]),e}(),M=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;(0,s.Z)(this,e),this.channel=t,this.event=r,this.payload=n,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}return(0,i.Z)(e,[{key:"resend",value:function(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}},{key:"send",value:function(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,"rate limited"===this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})&&(this.rateLimited=!0))}},{key:"updatePayload",value:function(e){this.payload=Object.assign(Object.assign({},this.payload),e)}},{key:"receive",value:function(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}},{key:"startTimeout",value:function(){var e=this;if(!this.timeoutTimer){this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},(function(t){e._cancelRefEvent(),e._cancelTimeout(),e.receivedResp=t,e._matchReceive(t)})),this.timeoutTimer=setTimeout((function(){e.trigger("timeout",{})}),this.timeout)}}},{key:"trigger",value:function(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}},{key:"destroy",value:function(){this._cancelRefEvent(),this._cancelTimeout()}},{key:"_cancelRefEvent",value:function(){this.refEvent&&this.channel._off(this.refEvent,{})}},{key:"_cancelTimeout",value:function(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}},{key:"_matchReceive",value:function(e){var t=e.status,r=e.response;this.recHooks.filter((function(e){return e.status===t})).forEach((function(e){return e.callback(r)}))}},{key:"_hasReceived",value:function(e){return this.receivedResp&&this.receivedResp.status===e}}]),e}();!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(L||(L={}));var J,H=function(){function e(t,r){var n=this;(0,s.Z)(this,e),this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:function(){},onLeave:function(){},onSync:function(){}};var i=(null===r||void 0===r?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},(function(t){var r=n.caller,s=r.onJoin,i=r.onLeave,a=r.onSync;n.joinRef=n.channel._joinRef(),n.state=e.syncState(n.state,t,s,i),n.pendingDiffs.forEach((function(t){n.state=e.syncDiff(n.state,t,s,i)})),n.pendingDiffs=[],a()})),this.channel._on(i.diff,{},(function(t){var r=n.caller,s=r.onJoin,i=r.onLeave,a=r.onSync;n.inPendingSyncState()?n.pendingDiffs.push(t):(n.state=e.syncDiff(n.state,t,s,i),a())})),this.onJoin((function(e,t,r){n.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})})),this.onLeave((function(e,t,r){n.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})})),this.onSync((function(){n.channel._trigger("presence",{event:"sync"})}))}return(0,i.Z)(e,[{key:"onJoin",value:function(e){this.caller.onJoin=e}},{key:"onLeave",value:function(e){this.caller.onLeave=e}},{key:"onSync",value:function(e){this.caller.onSync=e}},{key:"inPendingSyncState",value:function(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}],[{key:"syncState",value:function(e,t,r,n){var s=this.cloneDeep(e),i=this.transformState(t),a={},o={};return this.map(s,(function(e,t){i[e]||(o[e]=t)})),this.map(i,(function(e,t){var r=s[e];if(r){var n=t.map((function(e){return e.presence_ref})),i=r.map((function(e){return e.presence_ref})),c=t.filter((function(e){return i.indexOf(e.presence_ref)<0})),u=r.filter((function(e){return n.indexOf(e.presence_ref)<0}));c.length>0&&(a[e]=c),u.length>0&&(o[e]=u)}else a[e]=t})),this.syncDiff(s,{joins:a,leaves:o},r,n)}},{key:"syncDiff",value:function(e,t,r,n){var s=this,i={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)},a=i.joins,o=i.leaves;return r||(r=function(){}),n||(n=function(){}),this.map(a,(function(t,n){var i,a=null!==(i=e[t])&&void 0!==i?i:[];if(e[t]=s.cloneDeep(n),a.length>0){var o,c=e[t].map((function(e){return e.presence_ref})),u=a.filter((function(e){return c.indexOf(e.presence_ref)<0}));(o=e[t]).unshift.apply(o,(0,S.Z)(u))}r(t,a,n)})),this.map(o,(function(t,r){var s=e[t];if(s){var i=r.map((function(e){return e.presence_ref}));s=s.filter((function(e){return i.indexOf(e.presence_ref)<0})),e[t]=s,n(t,s,r),0===s.length&&delete e[t]}})),e}},{key:"map",value:function(e,t){return Object.getOwnPropertyNames(e).map((function(r){return t(r,e[r])}))}},{key:"transformState",value:function(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((function(t,r){var n=e[r];return t[r]="metas"in n?n.metas.map((function(e){return e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e})):n,t}),{})}},{key:"cloneDeep",value:function(e){return JSON.parse(JSON.stringify(e))}}]),e}();!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(J||(J={}));var z,G,K,q=function(e,t){var r,n=null!==(r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce((function(r,s){return r[s]=V(s,e,t,n),r}),{})},V=function(e,t,r,n){var s=t.find((function(t){return t.name===e})),i=null===s||void 0===s?void 0:s.type,a=r[e];return i&&!n.includes(i)?W(i,a):$(a)},W=function(e,t){if("_"===e.charAt(0)){var r=e.slice(1,e.length);return ee(t,r)}switch(e){case J.bool:return X(t);case J.float4:case J.float8:case J.int2:case J.int4:case J.int8:case J.numeric:case J.oid:return Y(t);case J.json:case J.jsonb:return Q(t);case J.timestamp:return te(t);case J.abstime:case J.date:case J.daterange:case J.int4range:case J.int8range:case J.money:case J.reltime:case J.text:case J.time:case J.timestamptz:case J.timetz:case J.tsrange:case J.tstzrange:default:return $(t)}},$=function(e){return e},X=function(e){switch(e){case"t":return!0;case"f":return!1;default:return e}},Y=function(e){if("string"===typeof e){var t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Q=function(e){if("string"===typeof e)try{return JSON.parse(e)}catch(t){return console.log("JSON parse error: ".concat(t)),e}return e},ee=function(e,t){if("string"!==typeof e)return e;var r=e.length-1,n=e[r];if("{"===e[0]&&"}"===n){var s,i=e.slice(1,r);try{s=JSON.parse("["+i+"]")}catch(a){s=i?i.split(","):[]}return s.map((function(e){return W(t,e)}))}return e},te=function(e){return"string"===typeof e?e.replace(" ","T"):e},re=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))};!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(z||(z={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes"}(G||(G={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(K||(K={}));var ne=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},i=arguments.length>2?arguments[2]:void 0;(0,s.Z)(this,e),this.topic=t,this.params=n,this.socket=i,this.bindings={},this.state=v.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},n.config),this.timeout=this.socket.timeout,this.joinPush=new M(this,p.join,this.params,this.timeout),this.rejoinTimer=new B((function(){return r._rejoinUntilConnected()}),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(function(){r.state=v.joined,r.rejoinTimer.reset(),r.pushBuffer.forEach((function(e){return e.send()})),r.pushBuffer=[]})),this._onClose((function(){r.rejoinTimer.reset(),r.socket.log("channel","close ".concat(r.topic," ").concat(r._joinRef())),r.state=v.closed,r.socket._remove(r)})),this._onError((function(e){r._isLeaving()||r._isClosed()||(r.socket.log("channel","error ".concat(r.topic),e),r.state=v.errored,r.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(function(){r._isJoining()&&(r.socket.log("channel","timeout ".concat(r.topic),r.joinPush.timeout),r.state=v.errored,r.rejoinTimer.scheduleTimeout())})),this._on(p.reply,{},(function(e,t){r._trigger(r._replyEventName(t),e)})),this.presence=new H(this)}return(0,i.Z)(e,[{key:"subscribe",value:function(e){var t,r,n=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";var i=this.params.config,a=i.broadcast,o=i.presence;this._onError((function(t){return e&&e("CHANNEL_ERROR",t)})),this._onClose((function(){return e&&e("CLOSED")}));var c={},u={broadcast:a,presence:o,postgres_changes:null!==(r=null===(t=this.bindings.postgres_changes)||void 0===t?void 0:t.map((function(e){return e.filter})))&&void 0!==r?r:[]};return this.socket.accessToken&&(c.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:u},c)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",(function(t){var r,s=t.postgres_changes;if(n.socket.accessToken&&n.socket.setAuth(n.socket.accessToken),void 0!==s){for(var i=n.bindings.postgres_changes,a=null!==(r=null===i||void 0===i?void 0:i.length)&&void 0!==r?r:0,o=[],c=0;c<a;c++){var u=i[c],h=u.filter,l=h.event,d=h.schema,f=h.table,v=h.filter,p=s&&s[c];if(!p||p.event!==l||p.schema!==d||p.table!==f||p.filter!==v)return n.unsubscribe(),void(e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes")));o.push(Object.assign(Object.assign({},u),{id:p.id}))}return n.bindings.postgres_changes=o,void(e&&e("SUBSCRIBED"))}e&&e("SUBSCRIBED")})).receive("error",(function(t){e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(function(){e&&e("TIMED_OUT")})),this}},{key:"presenceState",value:function(){return this.presence.state}},{key:"track",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return re(this,void 0,void 0,(0,n.Z)().mark((function r(){return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r,this)})))}},{key:"untrack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return re(this,void 0,void 0,(0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.send({type:"presence",event:"untrack"},e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"on",value:function(e,t,r){return this._on(e,t,r)}},{key:"send",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n){var s,i,a,o=t._push(e.type,e,r.timeout||t.timeout);o.rateLimited&&n("rate limited"),"broadcast"!==e.type||(null===(a=null===(i=null===(s=t.params)||void 0===s?void 0:s.config)||void 0===i?void 0:i.broadcast)||void 0===a?void 0:a.ack)||n("ok"),o.receive("ok",(function(){return n("ok")})),o.receive("timeout",(function(){return n("timed out")}))}))}},{key:"updateJoinPayload",value:function(e){this.joinPush.updatePayload(e)}},{key:"unsubscribe",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=v.leaving;var r=function(){e.socket.log("channel","leave ".concat(e.topic)),e._trigger(p.close,"leave",e._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((function(n){var s=new M(e,p.leave,{},t);s.receive("ok",(function(){r(),n("ok")})).receive("timeout",(function(){r(),n("timed out")})).receive("error",(function(){n("error")})),s.send(),e._canPush()||s.trigger("ok",{})}))}},{key:"_push",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");var n=new M(this,e,t,r);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}},{key:"_onMessage",value:function(e,t,r){return t}},{key:"_isMember",value:function(e){return this.topic===e}},{key:"_joinRef",value:function(){return this.joinPush.ref}},{key:"_trigger",value:function(e,t,r){var n,s,i=this,a=e.toLocaleLowerCase(),o=p.close,c=p.error,u=p.leave,h=p.join;if(!(r&&[o,c,u,h].indexOf(a)>=0&&r!==this._joinRef())){var l=this._onMessage(a,t,r);if(t&&!l)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter((function(e){var t,r,n;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(n=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===n?void 0:n.toLocaleLowerCase())===a})).map((function(e){return e.callback(l,r)})):null===(s=this.bindings[a])||void 0===s||s.filter((function(e){var r,n,s,i,o,c;if(["broadcast","presence","postgres_changes"].includes(a)){if("id"in e){var u=e.id,h=null===(r=e.filter)||void 0===r?void 0:r.event;return u&&(null===(n=t.ids)||void 0===n?void 0:n.includes(u))&&("*"===h||(null===h||void 0===h?void 0:h.toLocaleLowerCase())===(null===(s=t.data)||void 0===s?void 0:s.type.toLocaleLowerCase()))}var l=null===(o=null===(i=null===e||void 0===e?void 0:e.filter)||void 0===i?void 0:i.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===l||l===(null===(c=null===t||void 0===t?void 0:t.event)||void 0===c?void 0:c.toLocaleLowerCase())}return e.type.toLocaleLowerCase()===a})).map((function(e){if("object"===typeof l&&"ids"in l){var t=l.data,n={schema:t.schema,table:t.table,commit_timestamp:t.commit_timestamp,eventType:t.type,new:{},old:{},errors:t.errors};l=Object.assign(Object.assign({},n),i._getPayloadRecords(t))}e.callback(l,r)}))}}},{key:"_isClosed",value:function(){return this.state===v.closed}},{key:"_isJoined",value:function(){return this.state===v.joined}},{key:"_isJoining",value:function(){return this.state===v.joining}},{key:"_isLeaving",value:function(){return this.state===v.leaving}},{key:"_replyEventName",value:function(e){return"chan_reply_".concat(e)}},{key:"_on",value:function(e,t,r){var n=e.toLocaleLowerCase(),s={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}},{key:"_off",value:function(t,r){var n=t.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter((function(t){var s;return!((null===(s=t.type)||void 0===s?void 0:s.toLocaleLowerCase())===n&&e.isEqual(t.filter,r))})),this}},{key:"_rejoinUntilConnected",value:function(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}},{key:"_onClose",value:function(e){this._on(p.close,{},e)}},{key:"_onError",value:function(e){this._on(p.error,{},(function(t){return e(t)}))}},{key:"_canPush",value:function(){return this.socket.isConnected()&&this._isJoined()}},{key:"_rejoin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=v.joining,this.joinPush.resend(e))}},{key:"_getPayloadRecords",value:function(e){var t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=q(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=q(e.columns,e.old_record)),t}}],[{key:"isEqual",value:function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(e[r]!==t[r])return!1;return!0}}]),e}(),se=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},ie=function(){},ae=function(){function e(t,r){var i,a=this;(0,s.Z)(this,e),this.accessToken=null,this.channels=[],this.endPoint="",this.headers=N,this.params={},this.timeout=1e4,this.transport=D.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=ie,this.conn=null,this.sendBuffer=[],this.serializer=new F,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint="".concat(t,"/").concat(b.websocket),(null===r||void 0===r?void 0:r.params)&&(this.params=r.params),(null===r||void 0===r?void 0:r.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),r.headers)),(null===r||void 0===r?void 0:r.timeout)&&(this.timeout=r.timeout),(null===r||void 0===r?void 0:r.logger)&&(this.logger=r.logger),(null===r||void 0===r?void 0:r.transport)&&(this.transport=r.transport),(null===r||void 0===r?void 0:r.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=r.heartbeatIntervalMs);var o=null===(i=null===r||void 0===r?void 0:r.params)||void 0===i?void 0:i.eventsPerSecond;o&&(this.eventsPerSecondLimitMs=Math.floor(1e3/o)),this.reconnectAfterMs=(null===r||void 0===r?void 0:r.reconnectAfterMs)?r.reconnectAfterMs:function(e){return[1e3,2e3,5e3,1e4][e-1]||1e4},this.encode=(null===r||void 0===r?void 0:r.encode)?r.encode:function(e,t){return t(JSON.stringify(e))},this.decode=(null===r||void 0===r?void 0:r.decode)?r.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new B((function(){return se(a,void 0,void 0,(0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.disconnect(),this.connect();case 2:case"end":return e.stop()}}),e,this)})))}),this.reconnectAfterMs)}return(0,i.Z)(e,[{key:"connect",value:function(){var e=this;this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=function(){return e._onConnOpen()},this.conn.onerror=function(t){return e._onConnError(t)},this.conn.onmessage=function(t){return e._onConnMessage(t)},this.conn.onclose=function(t){return e._onConnClose(t)}))}},{key:"disconnect",value:function(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!==t&&void 0!==t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}},{key:"getChannels",value:function(){return this.channels}},{key:"removeChannel",value:function(e){return se(this,void 0,void 0,(0,n.Z)().mark((function t(){var r;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.unsubscribe();case 2:return r=t.sent,0===this.channels.length&&this.disconnect(),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"removeAllChannels",value:function(){return se(this,void 0,void 0,(0,n.Z)().mark((function e(){var t;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.channels.map((function(e){return e.unsubscribe()})));case 2:return t=e.sent,this.disconnect(),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"log",value:function(e,t,r){this.logger(e,t,r)}},{key:"connectionState",value:function(){switch(this.conn&&this.conn.readyState){case f.connecting:return y.Connecting;case f.open:return y.Open;case f.closing:return y.Closing;default:return y.Closed}}},{key:"isConnected",value:function(){return this.connectionState()===y.Open}},{key:"channel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};this.isConnected()||this.connect();var r=new ne("realtime:".concat(e),t,this);return this.channels.push(r),r}},{key:"push",value:function(e){var t=this,r=e.topic,n=e.event,s=e.payload,i=e.ref,a=function(){t.encode(e,(function(e){var r;null===(r=t.conn)||void 0===r||r.send(e)}))};if(this.log("push","".concat(r," ").concat(n," (").concat(i,")"),s),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(n)){if(this._throttle(a)())return"rate limited"}else a();else this.sendBuffer.push(a)}},{key:"setAuth",value:function(e){this.accessToken=e,this.channels.forEach((function(t){e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(p.access_token,{access_token:e})}))}},{key:"_makeRef",value:function(){var e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}},{key:"_leaveOpenTopic",value:function(e){var t=this.channels.find((function(t){return t.topic===e&&(t._isJoined()||t._isJoining())}));t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}},{key:"_remove",value:function(e){this.channels=this.channels.filter((function(t){return t._joinRef()!==e._joinRef()}))}},{key:"_endPointURL",value:function(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}},{key:"_onConnMessage",value:function(e){var t=this;this.decode(e.data,(function(e){var r=e.topic,n=e.event,s=e.payload,i=e.ref;(i&&i===t.pendingHeartbeatRef||n===(null===s||void 0===s?void 0:s.type))&&(t.pendingHeartbeatRef=null),t.log("receive","".concat(s.status||""," ").concat(r," ").concat(n," ").concat(i&&"("+i+")"||""),s),t.channels.filter((function(e){return e._isMember(r)})).forEach((function(e){return e._trigger(n,s,i)})),t.stateChangeCallbacks.message.forEach((function(t){return t(e)}))}))}},{key:"_onConnOpen",value:function(){var e=this;this.log("transport","connected to ".concat(this._endPointURL())),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((function(){return e._sendHeartbeat()}),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach((function(e){return e()}))}},{key:"_onConnClose",value:function(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((function(t){return t(e)}))}},{key:"_onConnError",value:function(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((function(t){return t(e)}))}},{key:"_triggerChanError",value:function(){this.channels.forEach((function(e){return e._trigger(p.error)}))}},{key:"_appendParams",value:function(e,t){if(0===Object.keys(t).length)return e;var r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return"".concat(e).concat(r).concat(n)}},{key:"_flushSendBuffer",value:function(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((function(e){return e()})),this.sendBuffer=[])}},{key:"_sendHeartbeat",value:function(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}},{key:"_throttle",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.eventsPerSecondLimitMs;return function(){return!!t.inThrottle||(e(),r>0&&(t.inThrottle=!0,setTimeout((function(){t.inThrottle=!1}),r)),!1)}}}]),e}(),oe=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).__isStorageError=!0,n.name="StorageError",n}return(0,i.Z)(r)}((0,m.Z)(Error));function ce(e){return"object"===typeof e&&null!==e&&"__isStorageError"in e}var ue=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),(i=t.call(this,e)).name="StorageApiError",i.status=n,i}return(0,i.Z)(r,[{key:"toJSON",value:function(){return{name:this.name,message:this.message,status:this.status}}}]),r}(oe),he=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),(i=t.call(this,e)).name="StorageUnknownError",i.originalError=n,i}return(0,i.Z)(r)}(oe),le=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},de=function(e){var t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return le(void 0,void 0,void 0,(0,n.Z)().mark((function e(){var s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.t.bind(r,4255,23));case 2:return e.next=4,(s=e.sent).fetch.apply(s,t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))}:fetch),function(){return t.apply(void 0,arguments)}},fe=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},ve=function(e){return e.msg||e.message||e.error_description||e.error||JSON.stringify(e)},pe=function(e,t){return fe(void 0,void 0,void 0,(0,n.Z)().mark((function s(){var i;return(0,n.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,le(void 0,void 0,void 0,(0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof Response){e.next=4;break}return e.next=3,Promise.resolve().then(r.t.bind(r,4255,23));case 3:return e.abrupt("return",e.sent.Response);case 4:return e.abrupt("return",Response);case 5:case"end":return e.stop()}}),e)})));case 2:i=s.sent,e instanceof i?e.json().then((function(r){t(new ue(ve(r),e.status||500))})).catch((function(e){t(new he(ve(e),e))})):t(new he(ve(e),e));case 4:case"end":return s.stop()}}),s)})))},be=function(e,t,r,n){var s={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"===e?s:(s.headers=Object.assign({"Content-Type":"application/json"},null===t||void 0===t?void 0:t.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};function ye(e,t,r,s,i,a){return fe(this,void 0,void 0,(0,n.Z)().mark((function o(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,o){e(r,be(t,s,i,a)).then((function(e){if(!e.ok)throw e;return(null===s||void 0===s?void 0:s.noResolveJson)?e:e.json()})).then((function(e){return n(e)})).catch((function(e){return pe(e,o)}))})));case 1:case"end":return n.stop()}}),o)})))}function me(e,t,r,s){return fe(this,void 0,void 0,(0,n.Z)().mark((function i(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",ye(e,"GET",t,r,s));case 1:case"end":return n.stop()}}),i)})))}function ke(e,t,r,s,i){return fe(this,void 0,void 0,(0,n.Z)().mark((function a(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",ye(e,"POST",t,s,i,r));case 1:case"end":return n.stop()}}),a)})))}function ge(e,t,r,s,i){return fe(this,void 0,void 0,(0,n.Z)().mark((function a(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",ye(e,"PUT",t,s,i,r));case 1:case"end":return n.stop()}}),a)})))}function we(e,t,r,s,i){return fe(this,void 0,void 0,(0,n.Z)().mark((function a(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",ye(e,"DELETE",t,s,i,r));case 1:case"end":return n.stop()}}),a)})))}var xe=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},_e={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ze={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},Te=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;(0,s.Z)(this,e),this.url=t,this.headers=r,this.bucketId=n,this.fetch=de(i)}return(0,i.Z)(e,[{key:"uploadOrUpdate",value:function(e,t,r,s){return xe(this,void 0,void 0,(0,n.Z)().mark((function i(){var a,o,c,u,h,l,d;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,o=Object.assign(Object.assign({},Ze),s),c=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(o.upsert)}),"undefined"!==typeof Blob&&r instanceof Blob?((a=new FormData).append("cacheControl",o.cacheControl),a.append("",r)):"undefined"!==typeof FormData&&r instanceof FormData?(a=r).append("cacheControl",o.cacheControl):(a=r,c["cache-control"]="max-age=".concat(o.cacheControl),c["content-type"]=o.contentType),u=this._removeEmptyFolders(t),h=this._getFinalPath(u),n.next=8,this.fetch("".concat(this.url,"/object/").concat(h),Object.assign({method:e,body:a,headers:c},(null===o||void 0===o?void 0:o.duplex)?{duplex:o.duplex}:{}));case 8:if(!(l=n.sent).ok){n.next=13;break}return n.abrupt("return",{data:{path:u},error:null});case 13:return n.next=15,l.json();case 15:return d=n.sent,n.abrupt("return",{data:null,error:d});case 17:n.next=24;break;case 19:if(n.prev=19,n.t0=n.catch(0),!ce(n.t0)){n.next=23;break}return n.abrupt("return",{data:null,error:n.t0});case 23:throw n.t0;case 24:case"end":return n.stop()}}),i,this,[[0,19]])})))}},{key:"upload",value:function(e,t,r){return xe(this,void 0,void 0,(0,n.Z)().mark((function s(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.uploadOrUpdate("POST",e,t,r));case 1:case"end":return n.stop()}}),s,this)})))}},{key:"uploadToSignedUrl",value:function(e,t,r,s){return xe(this,void 0,void 0,(0,n.Z)().mark((function i(){var a,o,c,u,h,l,d,f;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=this._removeEmptyFolders(e),o=this._getFinalPath(a),(c=new URL(this.url+"/object/upload/sign/".concat(o))).searchParams.set("token",t),n.prev=4,h=Object.assign({upsert:Ze.upsert},s),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)}),"undefined"!==typeof Blob&&r instanceof Blob?((u=new FormData).append("cacheControl",h.cacheControl),u.append("",r)):"undefined"!==typeof FormData&&r instanceof FormData?(u=r).append("cacheControl",h.cacheControl):(u=r,l["cache-control"]="max-age=".concat(h.cacheControl),l["content-type"]=h.contentType),n.next=10,this.fetch(c.toString(),{method:"PUT",body:u,headers:l});case 10:if(!(d=n.sent).ok){n.next=15;break}return n.abrupt("return",{data:{path:a},error:null});case 15:return n.next=17,d.json();case 17:return f=n.sent,n.abrupt("return",{data:null,error:f});case 19:n.next=26;break;case 21:if(n.prev=21,n.t0=n.catch(4),!ce(n.t0)){n.next=25;break}return n.abrupt("return",{data:null,error:n.t0});case 25:throw n.t0;case 26:case"end":return n.stop()}}),i,this,[[4,21]])})))}},{key:"createSignedUploadUrl",value:function(e){return xe(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i,a;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=this._getFinalPath(e),t.next=4,ke(this.fetch,"".concat(this.url,"/object/upload/sign/").concat(r),{},{headers:this.headers});case 4:if(s=t.sent,i=new URL(this.url+s.url),a=i.searchParams.get("token")){t.next=9;break}throw new oe("No token returned by API");case 9:return t.abrupt("return",{data:{signedUrl:i.toString(),path:e,token:a},error:null});case 12:if(t.prev=12,t.t0=t.catch(0),!ce(t.t0)){t.next=16;break}return t.abrupt("return",{data:null,error:t.t0});case 16:throw t.t0;case 17:case"end":return t.stop()}}),t,this,[[0,12]])})))}},{key:"update",value:function(e,t,r){return xe(this,void 0,void 0,(0,n.Z)().mark((function s(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.uploadOrUpdate("PUT",e,t,r));case 1:case"end":return n.stop()}}),s,this)})))}},{key:"move",value:function(e,t){return xe(this,void 0,void 0,(0,n.Z)().mark((function r(){var s;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,ke(this.fetch,"".concat(this.url,"/object/move"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers});case 3:return s=r.sent,r.abrupt("return",{data:s,error:null});case 7:if(r.prev=7,r.t0=r.catch(0),!ce(r.t0)){r.next=11;break}return r.abrupt("return",{data:null,error:r.t0});case 11:throw r.t0;case 12:case"end":return r.stop()}}),r,this,[[0,7]])})))}},{key:"copy",value:function(e,t){return xe(this,void 0,void 0,(0,n.Z)().mark((function r(){var s;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,ke(this.fetch,"".concat(this.url,"/object/copy"),{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers});case 3:return s=r.sent,r.abrupt("return",{data:{path:s.Key},error:null});case 7:if(r.prev=7,r.t0=r.catch(0),!ce(r.t0)){r.next=11;break}return r.abrupt("return",{data:null,error:r.t0});case 11:throw r.t0;case 12:case"end":return r.stop()}}),r,this,[[0,7]])})))}},{key:"createSignedUrl",value:function(e,t,r){return xe(this,void 0,void 0,(0,n.Z)().mark((function s(){var i,a,o,c;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,i=this._getFinalPath(e),n.next=4,ke(this.fetch,"".concat(this.url,"/object/sign/").concat(i),Object.assign({expiresIn:t},(null===r||void 0===r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});case 4:return a=n.sent,o=(null===r||void 0===r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"",c=encodeURI("".concat(this.url).concat(a.signedURL).concat(o)),a={signedUrl:c},n.abrupt("return",{data:a,error:null});case 11:if(n.prev=11,n.t0=n.catch(0),!ce(n.t0)){n.next=15;break}return n.abrupt("return",{data:null,error:n.t0});case 15:throw n.t0;case 16:case"end":return n.stop()}}),s,this,[[0,11]])})))}},{key:"createSignedUrls",value:function(e,t,r){return xe(this,void 0,void 0,(0,n.Z)().mark((function s(){var i,a,o=this;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,ke(this.fetch,"".concat(this.url,"/object/sign/").concat(this.bucketId),{expiresIn:t,paths:e},{headers:this.headers});case 3:return i=n.sent,a=(null===r||void 0===r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"",n.abrupt("return",{data:i.map((function(e){return Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI("".concat(o.url).concat(e.signedURL).concat(a)):null})})),error:null});case 8:if(n.prev=8,n.t0=n.catch(0),!ce(n.t0)){n.next=12;break}return n.abrupt("return",{data:null,error:n.t0});case 12:throw n.t0;case 13:case"end":return n.stop()}}),s,this,[[0,8]])})))}},{key:"download",value:function(e,t){return xe(this,void 0,void 0,(0,n.Z)().mark((function r(){var s,i,a,o,c,u,h;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s="undefined"!==typeof(null===t||void 0===t?void 0:t.transform),i=s?"render/image/authenticated":"object",a=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{}),o=a?"?".concat(a):"",r.prev=4,c=this._getFinalPath(e),r.next=8,me(this.fetch,"".concat(this.url,"/").concat(i,"/").concat(c).concat(o),{headers:this.headers,noResolveJson:!0});case 8:return u=r.sent,r.next=11,u.blob();case 11:return h=r.sent,r.abrupt("return",{data:h,error:null});case 15:if(r.prev=15,r.t0=r.catch(4),!ce(r.t0)){r.next=19;break}return r.abrupt("return",{data:null,error:r.t0});case 19:throw r.t0;case 20:case"end":return r.stop()}}),r,this,[[4,15]])})))}},{key:"getPublicUrl",value:function(e,t){var r=this._getFinalPath(e),n=[],s=(null===t||void 0===t?void 0:t.download)?"download=".concat(!0===t.download?"":t.download):"";""!==s&&n.push(s);var i="undefined"!==typeof(null===t||void 0===t?void 0:t.transform)?"render/image":"object",a=this.transformOptsToQueryString((null===t||void 0===t?void 0:t.transform)||{});""!==a&&n.push(a);var o=n.join("&");return""!==o&&(o="?".concat(o)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(i,"/public/").concat(r).concat(o))}}}},{key:"remove",value:function(e){return xe(this,void 0,void 0,(0,n.Z)().mark((function t(){var r;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,we(this.fetch,"".concat(this.url,"/object/").concat(this.bucketId),{prefixes:e},{headers:this.headers});case 3:return r=t.sent,t.abrupt("return",{data:r,error:null});case 7:if(t.prev=7,t.t0=t.catch(0),!ce(t.t0)){t.next=11;break}return t.abrupt("return",{data:null,error:t.t0});case 11:throw t.t0;case 12:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"list",value:function(e,t,r){return xe(this,void 0,void 0,(0,n.Z)().mark((function s(){var i,a;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,i=Object.assign(Object.assign(Object.assign({},_e),t),{prefix:e||""}),n.next=4,ke(this.fetch,"".concat(this.url,"/object/list/").concat(this.bucketId),i,{headers:this.headers},r);case 4:return a=n.sent,n.abrupt("return",{data:a,error:null});case 8:if(n.prev=8,n.t0=n.catch(0),!ce(n.t0)){n.next=12;break}return n.abrupt("return",{data:null,error:n.t0});case 12:throw n.t0;case 13:case"end":return n.stop()}}),s,this,[[0,8]])})))}},{key:"_getFinalPath",value:function(e){return"".concat(this.bucketId,"/").concat(e)}},{key:"_removeEmptyFolders",value:function(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}},{key:"transformOptsToQueryString",value:function(e){var t=[];return e.width&&t.push("width=".concat(e.width)),e.height&&t.push("height=".concat(e.height)),e.resize&&t.push("resize=".concat(e.resize)),e.format&&t.push("format=".concat(e.format)),e.quality&&t.push("quality=".concat(e.quality)),t.join("&")}}]),e}(),Se={"X-Client-Info":"storage-js/".concat("2.5.1")},Oe=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},Ee=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;(0,s.Z)(this,e),this.url=t,this.headers=Object.assign(Object.assign({},Se),r),this.fetch=de(n)}return(0,i.Z)(e,[{key:"listBuckets",value:function(){return Oe(this,void 0,void 0,(0,n.Z)().mark((function e(){var t;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,me(this.fetch,"".concat(this.url,"/bucket"),{headers:this.headers});case 3:return t=e.sent,e.abrupt("return",{data:t,error:null});case 7:if(e.prev=7,e.t0=e.catch(0),!ce(e.t0)){e.next=11;break}return e.abrupt("return",{data:null,error:e.t0});case 11:throw e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,7]])})))}},{key:"getBucket",value:function(e){return Oe(this,void 0,void 0,(0,n.Z)().mark((function t(){var r;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,me(this.fetch,"".concat(this.url,"/bucket/").concat(e),{headers:this.headers});case 3:return r=t.sent,t.abrupt("return",{data:r,error:null});case 7:if(t.prev=7,t.t0=t.catch(0),!ce(t.t0)){t.next=11;break}return t.abrupt("return",{data:null,error:t.t0});case 11:throw t.t0;case 12:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"createBucket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{public:!1};return Oe(this,void 0,void 0,(0,n.Z)().mark((function r(){var s;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,ke(this.fetch,"".concat(this.url,"/bucket"),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});case 3:return s=r.sent,r.abrupt("return",{data:s,error:null});case 7:if(r.prev=7,r.t0=r.catch(0),!ce(r.t0)){r.next=11;break}return r.abrupt("return",{data:null,error:r.t0});case 11:throw r.t0;case 12:case"end":return r.stop()}}),r,this,[[0,7]])})))}},{key:"updateBucket",value:function(e,t){return Oe(this,void 0,void 0,(0,n.Z)().mark((function r(){var s;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,ge(this.fetch,"".concat(this.url,"/bucket/").concat(e),{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});case 3:return s=r.sent,r.abrupt("return",{data:s,error:null});case 7:if(r.prev=7,r.t0=r.catch(0),!ce(r.t0)){r.next=11;break}return r.abrupt("return",{data:null,error:r.t0});case 11:throw r.t0;case 12:case"end":return r.stop()}}),r,this,[[0,7]])})))}},{key:"emptyBucket",value:function(e){return Oe(this,void 0,void 0,(0,n.Z)().mark((function t(){var r;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ke(this.fetch,"".concat(this.url,"/bucket/").concat(e,"/empty"),{},{headers:this.headers});case 3:return r=t.sent,t.abrupt("return",{data:r,error:null});case 7:if(t.prev=7,t.t0=t.catch(0),!ce(t.t0)){t.next=11;break}return t.abrupt("return",{data:null,error:t.t0});case 11:throw t.t0;case 12:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"deleteBucket",value:function(e){return Oe(this,void 0,void 0,(0,n.Z)().mark((function t(){var r;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,we(this.fetch,"".concat(this.url,"/bucket/").concat(e),{},{headers:this.headers});case 3:return r=t.sent,t.abrupt("return",{data:r,error:null});case 7:if(t.prev=7,t.t0=t.catch(0),!ce(t.t0)){t.next=11;break}return t.abrupt("return",{data:null,error:t.t0});case 11:throw t.t0;case 12:case"end":return t.stop()}}),t,this,[[0,7]])})))}}]),e}(),je=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return(0,s.Z)(this,r),t.call(this,e,n,i)}return(0,i.Z)(r,[{key:"from",value:function(e){return new Te(this.url,this.headers,e,this.fetch)}}]),r}(Ee),Pe={"X-Client-Info":"supabase-js/".concat("2.24.0")},Ae=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},Ce=function(e){var t;return t=e||("undefined"===typeof fetch?j():fetch),function(){return t.apply(void 0,arguments)}},Re=function(e,t,r){var s=Ce(r),i="undefined"===typeof Headers?E.Headers:Headers;return function(r,a){return Ae(void 0,void 0,void 0,(0,n.Z)().mark((function o(){var c,u,h;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t();case 2:if(n.t1=c=n.sent,n.t0=null!==n.t1,!n.t0){n.next=6;break}n.t0=void 0!==c;case 6:if(!n.t0){n.next=10;break}n.t2=c,n.next=11;break;case 10:n.t2=e;case 11:return u=n.t2,(h=new i(null===a||void 0===a?void 0:a.headers)).has("apikey")||h.set("apikey",e),h.has("Authorization")||h.set("Authorization","Bearer ".concat(u)),n.abrupt("return",s(r,Object.assign(Object.assign({},a),{headers:h})));case 16:case"end":return n.stop()}}),o)})))}};var Ie=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))};var Ue=function(){return"undefined"!==typeof document},De={tested:!1,writable:!1},Ne=function(){if(!Ue())return!1;try{if("object"!==typeof globalThis.localStorage)return!1}catch(t){return!1}if(De.tested)return De.writable;var e="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),De.tested=!0,De.writable=!0}catch(t){De.tested=!0,De.writable=!1}return De.writable};function Le(e,t){var r;t||(t=(null===(r=null===window||void 0===window?void 0:window.location)||void 0===r?void 0:r.href)||""),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&#]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}var Be=function(e){var t;return t=e||("undefined"===typeof fetch?function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return Ie(void 0,void 0,void 0,(0,n.Z)().mark((function e(){var s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.t.bind(r,4255,23));case 2:return e.next=4,(s=e.sent).fetch.apply(s,t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))}:fetch),function(){return t.apply(void 0,arguments)}},Fe=function(e,t,r){return Ie(void 0,void 0,void 0,(0,n.Z)().mark((function s(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.setItem(t,JSON.stringify(r));case 2:case"end":return n.stop()}}),s)})))},Me=function(e,t){return Ie(void 0,void 0,void 0,(0,n.Z)().mark((function r(){var s;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.getItem(t);case 2:if(s=r.sent){r.next=5;break}return r.abrupt("return",null);case 5:return r.prev=5,r.abrupt("return",JSON.parse(s));case 9:return r.prev=9,r.t0=r.catch(5),r.abrupt("return",s);case 12:case"end":return r.stop()}}),r,null,[[5,9]])})))},Je=function(e,t){return Ie(void 0,void 0,void 0,(0,n.Z)().mark((function r(){return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.removeItem(t);case 2:case"end":return r.stop()}}),r)})))};var He=(0,i.Z)((function e(){var t=this;(0,s.Z)(this,e),this.promise=new e.promiseConstructor((function(e,r){t.resolve=e,t.reject=r}))}));function ze(e){var t=e.split(".");if(3!==t.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");var r=t[1];return JSON.parse(function(e){var t,r,n,s,i,a,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",u=0;for(e=e.replace("-","+").replace("_","/");u<e.length;)t=o.indexOf(e.charAt(u++))<<2|(s=o.indexOf(e.charAt(u++)))>>4,r=(15&s)<<4|(i=o.indexOf(e.charAt(u++)))>>2,n=(3&i)<<6|(a=o.indexOf(e.charAt(u++))),c+=String.fromCharCode(t),64!=i&&0!=r&&(c+=String.fromCharCode(r)),64!=a&&0!=n&&(c+=String.fromCharCode(n));return c}(r))}function Ge(e){return new Promise((function(t){setTimeout((function(){return t(null)}),e)}))}function Ke(e,t){var r=this;return new Promise((function(s,i){Ie(r,void 0,void 0,(0,n.Z)().mark((function r(){var a,o;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=0;case 1:if(!(a<1/0)){r.next=19;break}return r.prev=2,r.next=5,e(a);case 5:if(o=r.sent,t(a,null,o)){r.next=9;break}return s(o),r.abrupt("return");case 9:r.next=16;break;case 11:if(r.prev=11,r.t0=r.catch(2),t(a,r.t0)){r.next=16;break}return i(r.t0),r.abrupt("return");case 16:a++,r.next=1;break;case 19:case"end":return r.stop()}}),r,null,[[2,11]])})))}))}function qe(e){return("0"+e.toString(16)).substr(-2)}function Ve(){var e=new Uint32Array(56);if("undefined"===typeof crypto){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r="",n=0;n<56;n++)r+=t.charAt(Math.floor(66*Math.random()));return r}return crypto.getRandomValues(e),Array.from(e,qe).join("")}function We(e){return Ie(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i,a;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new TextEncoder,s=r.encode(e),t.next=4,crypto.subtle.digest("SHA-256",s);case 4:return i=t.sent,a=new Uint8Array(i),t.abrupt("return",Array.from(a).map((function(e){return String.fromCharCode(e)})).join(""));case 7:case"end":return t.stop()}}),t)})))}function $e(e){return Ie(this,void 0,void 0,(0,n.Z)().mark((function t(){var r;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("undefined"!==typeof crypto){t.next=3;break}return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t.abrupt("return",e);case 3:return t.next=5,We(e);case 5:return r=t.sent,t.abrupt("return",btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""));case 7:case"end":return t.stop()}}),t)})))}He.promiseConstructor=Promise;var Xe=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),(i=t.call(this,e)).__isAuthError=!0,i.name="AuthError",i.status=n,i}return(0,i.Z)(r)}((0,m.Z)(Error));function Ye(e){return"object"===typeof e&&null!==e&&"__isAuthError"in e}var Qe=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),(i=t.call(this,e,n)).name="AuthApiError",i.status=n,i}return(0,i.Z)(r,[{key:"toJSON",value:function(){return{name:this.name,message:this.message,status:this.status}}}]),r}(Xe);function et(e){return Ye(e)&&"AuthApiError"===e.name}var tt=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e,n){var i;return(0,s.Z)(this,r),(i=t.call(this,e)).name="AuthUnknownError",i.originalError=n,i}return(0,i.Z)(r)}(Xe),rt=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e,n,i){var a;return(0,s.Z)(this,r),(a=t.call(this,e)).name=n,a.status=i,a}return(0,i.Z)(r,[{key:"toJSON",value:function(){return{name:this.name,message:this.message,status:this.status}}}]),r}(Xe),nt=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,s.Z)(this,r),t.call(this,"Auth session missing!","AuthSessionMissingError",400)}return(0,i.Z)(r)}(rt),st=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,s.Z)(this,r),t.call(this,"Auth session or user missing","AuthInvalidTokenResponseError",500)}return(0,i.Z)(r)}(rt),it=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e){return(0,s.Z)(this,r),t.call(this,e,"AuthInvalidCredentialsError",400)}return(0,i.Z)(r)}(rt),at=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,s.Z)(this,r),(n=t.call(this,e,"AuthImplicitGrantRedirectError",500)).details=null,n.details=i,n}return(0,i.Z)(r,[{key:"toJSON",value:function(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}]),r}(rt),ot=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,s.Z)(this,r),(n=t.call(this,e,"AuthPKCEGrantCodeExchangeError",500)).details=null,n.details=i,n}return(0,i.Z)(r,[{key:"toJSON",value:function(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}]),r}(rt),ct=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e,n){return(0,s.Z)(this,r),t.call(this,e,"AuthRetryableFetchError",n)}return(0,i.Z)(r)}(rt),ut=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},ht=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r},lt=function(e){return e.msg||e.message||e.error_description||e.error||JSON.stringify(e)},dt=function(e,t){return ut(void 0,void 0,void 0,(0,n.Z)().mark((function r(){var s;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:s=[502,503,504],"object"===typeof(n=e)&&null!==n&&"status"in n&&"ok"in n&&"json"in n&&"function"===typeof n.json?s.includes(e.status)?t(new ct(lt(e),e.status)):e.json().then((function(r){t(new Qe(lt(r),e.status||500))})).catch((function(e){t(new tt(lt(e),e))})):t(new ct(lt(e),0));case 2:case"end":return r.stop()}var n}),r)})))},ft=function(e,t,r,n){var s={method:e,headers:(null===t||void 0===t?void 0:t.headers)||{}};return"GET"===e?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null===t||void 0===t?void 0:t.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};function vt(e,t,r,s){var i;return ut(this,void 0,void 0,(0,n.Z)().mark((function a(){var o,c,u,h;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=Object.assign({},null===s||void 0===s?void 0:s.headers),(null===s||void 0===s?void 0:s.jwt)&&(o.Authorization="Bearer ".concat(s.jwt)),c=null!==(i=null===s||void 0===s?void 0:s.query)&&void 0!==i?i:{},(null===s||void 0===s?void 0:s.redirectTo)&&(c.redirect_to=s.redirectTo),u=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",n.next=7,pt(e,t,r+u,{headers:o,noResolveJson:null===s||void 0===s?void 0:s.noResolveJson},{},null===s||void 0===s?void 0:s.body);case 7:return h=n.sent,n.abrupt("return",(null===s||void 0===s?void 0:s.xform)?null===s||void 0===s?void 0:s.xform(h):{data:Object.assign({},h),error:null});case 9:case"end":return n.stop()}}),a)})))}function pt(e,t,r,s,i,a){return ut(this,void 0,void 0,(0,n.Z)().mark((function o(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,o){e(r,ft(t,s,i,a)).then((function(e){if(!e.ok)throw e;return(null===s||void 0===s?void 0:s.noResolveJson)?e:e.json()})).then((function(e){return n(e)})).catch((function(e){return dt(e,o)}))})));case 1:case"end":return n.stop()}}),o)})))}function bt(e){var t,r,n=null;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&((n=Object.assign({},e)).expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)),{data:{session:n,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function yt(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function mt(e){return{data:e,error:null}}function kt(e){var t=e.action_link,r=e.email_otp,n=e.hashed_token,s=e.redirect_to,i=e.verification_type,a=ht(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i},user:Object.assign({},a)},error:null}}function gt(e){return e}var wt=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},xt=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]])}return r},_t=function(){function e(t){var r=t.url,n=void 0===r?"":r,i=t.headers,a=void 0===i?{}:i,o=t.fetch;(0,s.Z)(this,e),this.url=n,this.headers=a,this.fetch=Be(o),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}return(0,i.Z)(e,[{key:"signOut",value:function(e){return wt(this,void 0,void 0,(0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,vt(this.fetch,"POST","".concat(this.url,"/logout"),{headers:this.headers,jwt:e,noResolveJson:!0});case 3:return t.abrupt("return",{data:null,error:null});case 6:if(t.prev=6,t.t0=t.catch(0),!Ye(t.t0)){t.next=10;break}return t.abrupt("return",{data:null,error:t.t0});case 10:throw t.t0;case 11:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"inviteUserByEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return wt(this,void 0,void 0,(0,n.Z)().mark((function r(){return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,vt(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:yt});case 3:return r.abrupt("return",r.sent);case 6:if(r.prev=6,r.t0=r.catch(0),!Ye(r.t0)){r.next=10;break}return r.abrupt("return",{data:{user:null},error:r.t0});case 10:throw r.t0;case 11:case"end":return r.stop()}}),r,this,[[0,6]])})))}},{key:"generateLink",value:function(e){return wt(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=e.options,s=xt(e,["options"]),i=Object.assign(Object.assign({},s),r),"newEmail"in s&&(i.new_email=null===s||void 0===s?void 0:s.newEmail,delete i.newEmail),t.next=6,vt(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:i,headers:this.headers,xform:kt,redirectTo:null===r||void 0===r?void 0:r.redirectTo});case 6:return t.abrupt("return",t.sent);case 9:if(t.prev=9,t.t0=t.catch(0),!Ye(t.t0)){t.next=13;break}return t.abrupt("return",{data:{properties:null,user:null},error:t.t0});case 13:throw t.t0;case 14:case"end":return t.stop()}}),t,this,[[0,9]])})))}},{key:"createUser",value:function(e){return wt(this,void 0,void 0,(0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,vt(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:e,headers:this.headers,xform:yt});case 3:return t.abrupt("return",t.sent);case 6:if(t.prev=6,t.t0=t.catch(0),!Ye(t.t0)){t.next=10;break}return t.abrupt("return",{data:{user:null},error:t.t0});case 10:throw t.t0;case 11:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"listUsers",value:function(e){var t,r,s,i,a,o,c;return wt(this,void 0,void 0,(0,n.Z)().mark((function u(){var h,l,d,f,v;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,h={nextPage:null,lastPage:0,total:0},n.next=4,vt(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null===e||void 0===e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(i=null===(s=null===e||void 0===e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==i?i:""},xform:gt});case 4:if(!(l=n.sent).error){n.next=7;break}throw l.error;case 7:return n.next=9,l.json();case 9:return d=n.sent,f=null!==(a=l.headers.get("x-total-count"))&&void 0!==a?a:0,(v=null!==(c=null===(o=l.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==c?c:[]).length>0&&(v.forEach((function(e){var t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);h["".concat(r,"Page")]=t})),h.total=parseInt(f)),n.abrupt("return",{data:Object.assign(Object.assign({},d),h),error:null});case 16:if(n.prev=16,n.t0=n.catch(0),!Ye(n.t0)){n.next=20;break}return n.abrupt("return",{data:{users:[]},error:n.t0});case 20:throw n.t0;case 21:case"end":return n.stop()}}),u,this,[[0,16]])})))}},{key:"getUserById",value:function(e){return wt(this,void 0,void 0,(0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,vt(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,xform:yt});case 3:return t.abrupt("return",t.sent);case 6:if(t.prev=6,t.t0=t.catch(0),!Ye(t.t0)){t.next=10;break}return t.abrupt("return",{data:{user:null},error:t.t0});case 10:throw t.t0;case 11:case"end":return t.stop()}}),t,this,[[0,6]])})))}},{key:"updateUserById",value:function(e,t){return wt(this,void 0,void 0,(0,n.Z)().mark((function r(){return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,vt(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(e),{body:t,headers:this.headers,xform:yt});case 3:return r.abrupt("return",r.sent);case 6:if(r.prev=6,r.t0=r.catch(0),!Ye(r.t0)){r.next=10;break}return r.abrupt("return",{data:{user:null},error:r.t0});case 10:throw r.t0;case 11:case"end":return r.stop()}}),r,this,[[0,6]])})))}},{key:"deleteUser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return wt(this,void 0,void 0,(0,n.Z)().mark((function r(){return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,vt(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e),{headers:this.headers,body:{should_soft_delete:t},xform:yt});case 3:return r.abrupt("return",r.sent);case 6:if(r.prev=6,r.t0=r.catch(0),!Ye(r.t0)){r.next=10;break}return r.abrupt("return",{data:{user:null},error:r.t0});case 10:throw r.t0;case 11:case"end":return r.stop()}}),r,this,[[0,6]])})))}},{key:"_listFactors",value:function(e){return wt(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,vt(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(e.userId,"/factors"),{headers:this.headers,xform:function(e){return{data:{factors:e},error:null}}});case 3:return r=t.sent,s=r.data,i=r.error,t.abrupt("return",{data:s,error:i});case 9:if(t.prev=9,t.t0=t.catch(0),!Ye(t.t0)){t.next=13;break}return t.abrupt("return",{data:null,error:t.t0});case 13:throw t.t0;case 14:case"end":return t.stop()}}),t,this,[[0,9]])})))}},{key:"_deleteFactor",value:function(e){return wt(this,void 0,void 0,(0,n.Z)().mark((function t(){var r;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,vt(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(e.userId,"/factors/").concat(e.id),{headers:this.headers});case 3:return r=t.sent,t.abrupt("return",{data:r,error:null});case 7:if(t.prev=7,t.t0=t.catch(0),!Ye(t.t0)){t.next=11;break}return t.abrupt("return",{data:null,error:t.t0});case 11:throw t.t0;case 12:case"end":return t.stop()}}),t,this,[[0,7]])})))}}]),e}(),Zt={"X-Client-Info":"gotrue-js/".concat("2.29.0")},Tt={getItem:function(e){return Ne()?globalThis.localStorage.getItem(e):null},setItem:function(e,t){Ne()&&globalThis.localStorage.setItem(e,t)},removeItem:function(e){Ne()&&globalThis.localStorage.removeItem(e)}};var St=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))};!function(){if("object"!==typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!==typeof self&&(self.globalThis=self)}}();var Ot={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Zt,flowType:"implicit"},Et=3e4,jt=function(){function e(t){var r,n=this;(0,s.Z)(this,e),this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null;var i=Object.assign(Object.assign({},Ot),t);if(this.inMemorySession=null,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.persistSession=i.persistSession,this.storage=i.storage||Tt,this.admin=new _t({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Be(i.fetch),this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===Tt&&!Ne()&&console.warn("No storage option exists to persist the session, which may result in unexpected behavior when using auth.\n        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning."),Ue()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",(function(e){n._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}return(0,i.Z)(e,[{key:"initialize",value:function(){return this.initializePromise||(this.initializePromise=this._initialize()),this.initializePromise}},{key:"_initialize",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){var t,r,s,i,a,o,c=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.initializePromise){e.next=2;break}return e.abrupt("return",this.initializePromise);case 2:if(e.prev=2,!Ue()){e.next=9;break}return e.next=6,this._isPKCEFlow();case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=!1;case 10:if(!((t=e.t0)||this.detectSessionInUrl&&this._isImplicitGrantFlow())){e.next=26;break}return e.next=14,this._getSessionFromUrl(t);case 14:if(r=e.sent,s=r.data,!(i=r.error)){e.next=21;break}return e.next=20,this._removeSession();case 20:return e.abrupt("return",{error:i});case 21:return a=s.session,o=s.redirectType,e.next=24,this._saveSession(a);case 24:return setTimeout((function(){"recovery"===o?c._notifyAllSubscribers("PASSWORD_RECOVERY",a):c._notifyAllSubscribers("SIGNED_IN",a)}),0),e.abrupt("return",{error:null});case 26:return e.next=28,this._recoverAndRefresh();case 28:return e.abrupt("return",{error:null});case 31:if(e.prev=31,e.t1=e.catch(2),!Ye(e.t1)){e.next=35;break}return e.abrupt("return",{error:e.t1});case 35:return e.abrupt("return",{error:new tt("Unexpected error during initialization",e.t1)});case 36:return e.prev=36,e.next=39,this._handleVisibilityChange();case 39:return e.finish(36);case 40:case"end":return e.stop()}}),e,this,[[2,31,36,40]])})))}},{key:"signUp",value:function(e){var t,r,s;return St(this,void 0,void 0,(0,n.Z)().mark((function i(){var a,o,c,u,h,l,d,f,v,p,b,y,m,k,g;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this._removeSession();case 3:if(!("email"in e)){n.next=20;break}if(o=e.email,c=e.password,u=e.options,h=null,l=null,"pkce"!==this.flowType){n.next=15;break}return d=Ve(),n.next=11,Fe(this.storage,"".concat(this.storageKey,"-code-verifier"),d);case 11:return n.next=13,$e(d);case 13:h=n.sent,l=d===h?"plain":"s256";case 15:return n.next=17,vt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:null===u||void 0===u?void 0:u.emailRedirectTo,body:{email:o,password:c,data:null!==(t=null===u||void 0===u?void 0:u.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null===u||void 0===u?void 0:u.captchaToken},code_challenge:h,code_challenge_method:l},xform:bt});case 17:a=n.sent,n.next=28;break;case 20:if(!("phone"in e)){n.next=27;break}return f=e.phone,v=e.password,p=e.options,n.next=24,vt(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:f,password:v,data:null!==(r=null===p||void 0===p?void 0:p.data)&&void 0!==r?r:{},channel:null!==(s=null===p||void 0===p?void 0:p.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null===p||void 0===p?void 0:p.captchaToken}},xform:bt});case 24:a=n.sent,n.next=28;break;case 27:throw new it("You must provide either an email or phone number and a password");case 28:if(y=(b=a).data,!(m=b.error)&&y){n.next=31;break}return n.abrupt("return",{data:{user:null,session:null},error:m});case 31:if(k=y.session,g=y.user,!y.session){n.next=37;break}return n.next=36,this._saveSession(y.session);case 36:this._notifyAllSubscribers("SIGNED_IN",k);case 37:return n.abrupt("return",{data:{user:g,session:k},error:null});case 40:if(n.prev=40,n.t0=n.catch(0),!Ye(n.t0)){n.next=44;break}return n.abrupt("return",{data:{user:null,session:null},error:n.t0});case 44:throw n.t0;case 45:case"end":return n.stop()}}),i,this,[[0,40]])})))}},{key:"signInWithPassword",value:function(e){return St(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i,a,o,c,u,h,l,d;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._removeSession();case 3:if(!("email"in e)){t.next=10;break}return s=e.email,i=e.password,a=e.options,t.next=7,vt(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}},xform:bt});case 7:r=t.sent,t.next=18;break;case 10:if(!("phone"in e)){t.next=17;break}return o=e.phone,c=e.password,u=e.options,t.next=14,vt(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:o,password:c,gotrue_meta_security:{captcha_token:null===u||void 0===u?void 0:u.captchaToken}},xform:bt});case 14:r=t.sent,t.next=18;break;case 17:throw new it("You must provide either an email or phone number and a password");case 18:if(l=(h=r).data,!(d=h.error)){t.next=23;break}return t.abrupt("return",{data:{user:null,session:null},error:d});case 23:if(l&&l.session&&l.user){t.next=25;break}return t.abrupt("return",{data:{user:null,session:null},error:new st});case 25:if(!l.session){t.next=29;break}return t.next=28,this._saveSession(l.session);case 28:this._notifyAllSubscribers("SIGNED_IN",l.session);case 29:return t.abrupt("return",{data:{user:l.user,session:l.session},error:d});case 32:if(t.prev=32,t.t0=t.catch(0),!Ye(t.t0)){t.next=36;break}return t.abrupt("return",{data:{user:null,session:null},error:t.t0});case 36:throw t.t0;case 37:case"end":return t.stop()}}),t,this,[[0,32]])})))}},{key:"signInWithOAuth",value:function(e){var t,r,s,i;return St(this,void 0,void 0,(0,n.Z)().mark((function a(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._removeSession();case 2:return n.next=4,this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect});case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}}),a,this)})))}},{key:"exchangeCodeForSession",value:function(e){return St(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i,a;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Me(this.storage,"".concat(this.storageKey,"-code-verifier"));case 2:return r=t.sent,t.next=5,vt(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:bt});case 5:return s=t.sent,i=s.data,a=s.error,t.next=10,Je(this.storage,"".concat(this.storageKey,"-code-verifier"));case 10:if(!a){t.next=14;break}return t.abrupt("return",{data:{user:null,session:null},error:a});case 14:if(i&&i.session&&i.user){t.next=16;break}return t.abrupt("return",{data:{user:null,session:null},error:new st});case 16:if(!i.session){t.next=20;break}return t.next=19,this._saveSession(i.session);case 19:this._notifyAllSubscribers("SIGNED_IN",i.session);case 20:return t.abrupt("return",{data:i,error:a});case 21:case"end":return t.stop()}}),t,this)})))}},{key:"signInWithIdToken",value:function(e){return St(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i,a,o,c,u;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._removeSession();case 2:return t.prev=2,r=e.options,s=e.provider,i=e.token,a=e.nonce,t.next=6,vt(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:s,id_token:i,nonce:a,gotrue_meta_security:{captcha_token:null===r||void 0===r?void 0:r.captchaToken}},xform:bt});case 6:if(o=t.sent,c=o.data,!(u=o.error)){t.next=12;break}return t.abrupt("return",{data:{user:null,session:null},error:u});case 12:if(c&&c.session&&c.user){t.next=14;break}return t.abrupt("return",{data:{user:null,session:null},error:new st});case 14:if(!c.session){t.next=18;break}return t.next=17,this._saveSession(c.session);case 17:this._notifyAllSubscribers("SIGNED_IN",c.session);case 18:return t.abrupt("return",{data:c,error:u});case 21:if(t.prev=21,t.t0=t.catch(2),!Ye(t.t0)){t.next=25;break}return t.abrupt("return",{data:{user:null,session:null},error:t.t0});case 25:throw t.t0;case 26:case"end":return t.stop()}}),t,this,[[2,21]])})))}},{key:"signInWithOtp",value:function(e){var t,r,s,i,a;return St(this,void 0,void 0,(0,n.Z)().mark((function o(){var c,u,h,l,d,f,v,p,b,y,m;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this._removeSession();case 3:if(!("email"in e)){n.next=20;break}if(c=e.email,u=e.options,h=null,l=null,"pkce"!==this.flowType){n.next=15;break}return d=Ve(),n.next=11,Fe(this.storage,"".concat(this.storageKey,"-code-verifier"),d);case 11:return n.next=13,$e(d);case 13:h=n.sent,l=d===h?"plain":"s256";case 15:return n.next=17,vt(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:c,data:null!==(t=null===u||void 0===u?void 0:u.data)&&void 0!==t?t:{},create_user:null===(r=null===u||void 0===u?void 0:u.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null===u||void 0===u?void 0:u.captchaToken},code_challenge:h,code_challenge_method:l},redirectTo:null===u||void 0===u?void 0:u.emailRedirectTo});case 17:return f=n.sent,v=f.error,n.abrupt("return",{data:{user:null,session:null},error:v});case 20:if(!("phone"in e)){n.next=27;break}return p=e.phone,b=e.options,n.next=24,vt(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:p,data:null!==(s=null===b||void 0===b?void 0:b.data)&&void 0!==s?s:{},create_user:null===(i=null===b||void 0===b?void 0:b.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null===b||void 0===b?void 0:b.captchaToken},channel:null!==(a=null===b||void 0===b?void 0:b.channel)&&void 0!==a?a:"sms"}});case 24:return y=n.sent,m=y.error,n.abrupt("return",{data:{user:null,session:null},error:m});case 27:throw new it("You must provide either an email or phone number.");case 30:if(n.prev=30,n.t0=n.catch(0),!Ye(n.t0)){n.next=34;break}return n.abrupt("return",{data:{user:null,session:null},error:n.t0});case 34:throw n.t0;case 35:case"end":return n.stop()}}),o,this,[[0,30]])})))}},{key:"verifyOtp",value:function(e){var t,r;return St(this,void 0,void 0,(0,n.Z)().mark((function s(){var i,a,o,c,u;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,"email_change"===e.type||"phone_change"===e.type){n.next=4;break}return n.next=4,this._removeSession();case 4:return n.next=6,vt(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:null===(t=e.options)||void 0===t?void 0:t.captchaToken}}),redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,xform:bt});case 6:if(i=n.sent,a=i.data,!(o=i.error)){n.next=11;break}throw o;case 11:if(a){n.next=13;break}throw new Error("An error occurred on token verification.");case 13:if(c=a.session,u=a.user,!(null===c||void 0===c?void 0:c.access_token)){n.next=19;break}return n.next=18,this._saveSession(c);case 18:this._notifyAllSubscribers("SIGNED_IN",c);case 19:return n.abrupt("return",{data:{user:u,session:c},error:null});case 22:if(n.prev=22,n.t0=n.catch(0),!Ye(n.t0)){n.next=26;break}return n.abrupt("return",{data:{user:null,session:null},error:n.t0});case 26:throw n.t0;case 27:case"end":return n.stop()}}),s,this,[[0,22]])})))}},{key:"signInWithSSO",value:function(e){var t,r,s;return St(this,void 0,void 0,(0,n.Z)().mark((function i(){return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this._removeSession();case 3:return n.next=5,vt(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null===e||void 0===e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:mt});case 5:return n.abrupt("return",n.sent);case 8:if(n.prev=8,n.t0=n.catch(0),!Ye(n.t0)){n.next=12;break}return n.abrupt("return",{data:null,error:n.t0});case 12:throw n.t0;case 13:case"end":return n.stop()}}),i,this,[[0,8]])})))}},{key:"reauthenticate",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){var t,r,s,i,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getSession();case 3:if(t=e.sent,r=t.data.session,!(s=t.error)){e.next=8;break}throw s;case 8:if(r){e.next=10;break}throw new nt;case 10:return e.next=12,vt(this.fetch,"GET","".concat(this.url,"/reauthenticate"),{headers:this.headers,jwt:r.access_token});case 12:return i=e.sent,a=i.error,e.abrupt("return",{data:{user:null,session:null},error:a});case 17:if(e.prev=17,e.t0=e.catch(0),!Ye(e.t0)){e.next=21;break}return e.abrupt("return",{data:{user:null,session:null},error:e.t0});case 21:throw e.t0;case 22:case"end":return e.stop()}}),e,this,[[0,17]])})))}},{key:"resend",value:function(e){return St(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i,a,o,c,u,h,l,d,f;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._removeSession();case 3:if(r="".concat(this.url,"/resend"),!("email"in e)){t.next=13;break}return s=e.email,i=e.type,a=e.options,t.next=8,vt(this.fetch,"POST",r,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:null===a||void 0===a?void 0:a.captchaToken}}});case 8:return o=t.sent,c=o.error,t.abrupt("return",{data:{user:null,session:null},error:c});case 13:if(!("phone"in e)){t.next=20;break}return u=e.phone,h=e.type,l=e.options,t.next=17,vt(this.fetch,"POST",r,{headers:this.headers,body:{phone:u,type:h,gotrue_meta_security:{captcha_token:null===l||void 0===l?void 0:l.captchaToken}}});case 17:return d=t.sent,f=d.error,t.abrupt("return",{data:{user:null,session:null},error:f});case 20:throw new it("You must provide either an email or phone number and a type");case 23:if(t.prev=23,t.t0=t.catch(0),!Ye(t.t0)){t.next=27;break}return t.abrupt("return",{data:{user:null,session:null},error:t.t0});case 27:throw t.t0;case 28:case"end":return t.stop()}}),t,this,[[0,23]])})))}},{key:"getSession",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){var t,r,s,i,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initializePromise;case 2:if(t=null,!this.persistSession){e.next=16;break}return e.next=6,Me(this.storage,this.storageKey);case 6:if(null===(r=e.sent)){e.next=14;break}if(!this._isValidSession(r)){e.next=12;break}t=r,e.next=14;break;case 12:return e.next=14,this._removeSession();case 14:e.next=17;break;case 16:t=this.inMemorySession;case 17:if(t){e.next=19;break}return e.abrupt("return",{data:{session:null},error:null});case 19:if(!!t.expires_at&&t.expires_at<=Date.now()/1e3){e.next=22;break}return e.abrupt("return",{data:{session:t},error:null});case 22:return e.next=24,this._callRefreshToken(t.refresh_token);case 24:if(s=e.sent,i=s.session,!(a=s.error)){e.next=29;break}return e.abrupt("return",{data:{session:null},error:a});case 29:return e.abrupt("return",{data:{session:i},error:null});case 30:case"end":return e.stop()}}),e,this)})))}},{key:"getUser",value:function(e){var t,r;return St(this,void 0,void 0,(0,n.Z)().mark((function s(){var i,a,o;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,e){n.next=10;break}return n.next=4,this.getSession();case 4:if(i=n.sent,a=i.data,!(o=i.error)){n.next=9;break}throw o;case 9:e=null!==(r=null===(t=a.session)||void 0===t?void 0:t.access_token)&&void 0!==r?r:void 0;case 10:return n.next=12,vt(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:e,xform:yt});case 12:return n.abrupt("return",n.sent);case 15:if(n.prev=15,n.t0=n.catch(0),!Ye(n.t0)){n.next=19;break}return n.abrupt("return",{data:{user:null},error:n.t0});case 19:throw n.t0;case 20:case"end":return n.stop()}}),s,this,[[0,15]])})))}},{key:"updateUser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return St(this,void 0,void 0,(0,n.Z)().mark((function r(){var s,i,a,o,c,u,h;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.getSession();case 3:if(s=r.sent,i=s.data,!(a=s.error)){r.next=8;break}throw a;case 8:if(i.session){r.next=10;break}throw new nt;case 10:return o=i.session,r.next=13,vt(this.fetch,"PUT","".concat(this.url,"/user"),{headers:this.headers,redirectTo:null===t||void 0===t?void 0:t.emailRedirectTo,body:e,jwt:o.access_token,xform:yt});case 13:if(c=r.sent,u=c.data,!(h=c.error)){r.next=18;break}throw h;case 18:return o.user=u.user,r.next=21,this._saveSession(o);case 21:return this._notifyAllSubscribers("USER_UPDATED",o),r.abrupt("return",{data:{user:o.user},error:null});case 25:if(r.prev=25,r.t0=r.catch(0),!Ye(r.t0)){r.next=29;break}return r.abrupt("return",{data:{user:null},error:r.t0});case 29:throw r.t0;case 30:case"end":return r.stop()}}),r,this,[[0,25]])})))}},{key:"_decodeJWT",value:function(e){return ze(e)}},{key:"setSession",value:function(e){return St(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i,a,o,c,u,h,l,d,f;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.access_token&&e.refresh_token){t.next=3;break}throw new nt;case 3:if(r=Date.now()/1e3,s=r,i=!0,a=null,(o=ze(e.access_token)).exp&&(s=o.exp,i=s<=r),!i){t.next=22;break}return t.next=12,this._callRefreshToken(e.refresh_token);case 12:if(c=t.sent,u=c.session,!(h=c.error)){t.next=17;break}return t.abrupt("return",{data:{user:null,session:null},error:h});case 17:if(u){t.next=19;break}return t.abrupt("return",{data:{user:null,session:null},error:null});case 19:a=u,t.next=33;break;case 22:return t.next=24,this.getUser(e.access_token);case 24:if(l=t.sent,d=l.data,!(f=l.error)){t.next=29;break}throw f;case 29:return a={access_token:e.access_token,refresh_token:e.refresh_token,user:d.user,token_type:"bearer",expires_in:s-r,expires_at:s},t.next=32,this._saveSession(a);case 32:this._notifyAllSubscribers("SIGNED_IN",a);case 33:return t.abrupt("return",{data:{user:a.user,session:a},error:null});case 36:if(t.prev=36,t.t0=t.catch(0),!Ye(t.t0)){t.next=40;break}return t.abrupt("return",{data:{session:null,user:null},error:t.t0});case 40:throw t.t0;case 41:case"end":return t.stop()}}),t,this,[[0,36]])})))}},{key:"refreshSession",value:function(e){var t;return St(this,void 0,void 0,(0,n.Z)().mark((function r(){var s,i,a,o,c,u;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,e){r.next=10;break}return r.next=4,this.getSession();case 4:if(s=r.sent,i=s.data,!(a=s.error)){r.next=9;break}throw a;case 9:e=null!==(t=i.session)&&void 0!==t?t:void 0;case 10:if(null===e||void 0===e?void 0:e.refresh_token){r.next=12;break}throw new nt;case 12:return r.next=14,this._callRefreshToken(e.refresh_token);case 14:if(o=r.sent,c=o.session,!(u=o.error)){r.next=19;break}return r.abrupt("return",{data:{user:null,session:null},error:u});case 19:if(c){r.next=21;break}return r.abrupt("return",{data:{user:null,session:null},error:null});case 21:return r.abrupt("return",{data:{user:c.user,session:c},error:null});case 24:if(r.prev=24,r.t0=r.catch(0),!Ye(r.t0)){r.next=28;break}return r.abrupt("return",{data:{user:null,session:null},error:r.t0});case 28:throw r.t0;case 29:case"end":return r.stop()}}),r,this,[[0,24]])})))}},{key:"_getSessionFromUrl",value:function(e){return St(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i,a,o,c,u,h,l,d,f,v,p,b,y,m,k,g,w,x,_,Z;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,Ue()){t.next=3;break}throw new at("No browser detected.");case 3:if("implicit"!==this.flowType||this._isImplicitGrantFlow()){t.next=7;break}throw new at("Not a valid implicit grant flow url.");case 7:if("pkce"!=this.flowType||e){t.next=9;break}throw new ot("Not a valid PKCE flow url.");case 9:if(!e){t.next=26;break}if(r=Le("code")){t.next=13;break}throw new ot("No code detected.");case 13:return t.next=15,this.exchangeCodeForSession(r);case 15:if(s=t.sent,i=s.data,!(a=s.error)){t.next=20;break}throw a;case 20:if(i.session){t.next=22;break}throw new ot("No session detected.");case 22:return(o=new URL(window.location.href)).searchParams.delete("code"),window.history.replaceState(window.history.state,"",o.toString()),t.abrupt("return",{data:{session:i.session,redirectType:null},error:null});case 26:if(!(c=Le("error_description"))){t.next=35;break}if(u=Le("error_code")){t.next=31;break}throw new at("No error_code detected.");case 31:if(h=Le("error")){t.next=34;break}throw new at("No error detected.");case 34:throw new at(c,{error:h,code:u});case 35:if(l=Le("provider_token"),d=Le("provider_refresh_token"),f=Le("access_token")){t.next=40;break}throw new at("No access_token detected.");case 40:if(v=Le("expires_in")){t.next=43;break}throw new at("No expires_in detected.");case 43:if(p=Le("refresh_token")){t.next=46;break}throw new at("No refresh_token detected.");case 46:if(b=Le("token_type")){t.next=49;break}throw new at("No token_type detected.");case 49:return y=Math.round(Date.now()/1e3),m=y+parseInt(v),t.next=53,this.getUser(f);case 53:if(k=t.sent,g=k.data,!(w=k.error)){t.next=58;break}throw w;case 58:return x=g.user,_={provider_token:l,provider_refresh_token:d,access_token:f,expires_in:parseInt(v),expires_at:m,refresh_token:p,token_type:b,user:x},Z=Le("type"),window.location.hash="",t.abrupt("return",{data:{session:_,redirectType:Z},error:null});case 65:if(t.prev=65,t.t0=t.catch(0),!Ye(t.t0)){t.next=69;break}return t.abrupt("return",{data:{session:null,redirectType:null},error:t.t0});case 69:throw t.t0;case 70:case"end":return t.stop()}}),t,this,[[0,65]])})))}},{key:"_isImplicitGrantFlow",value:function(){return Ue()&&(Boolean(Le("access_token"))||Boolean(Le("error_description")))}},{key:"_isPKCEFlow",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){var t;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Me(this.storage,"".concat(this.storageKey,"-code-verifier"));case 2:return t=e.sent,e.abrupt("return",Boolean(Le("code"))&&Boolean(t));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"signOut",value:function(){var e;return St(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i,a,o,c;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSession();case 2:if(r=t.sent,s=r.data,!(i=r.error)){t.next=7;break}return t.abrupt("return",{error:i});case 7:if(!(a=null===(e=s.session)||void 0===e?void 0:e.access_token)){t.next=16;break}return t.next=11,this.admin.signOut(a);case 11:if(o=t.sent,!(c=o.error)){t.next=16;break}if(et(c)&&(404===c.status||401===c.status)){t.next=16;break}return t.abrupt("return",{error:c});case 16:return t.next=18,this._removeSession();case 18:return t.next=20,Je(this.storage,"".concat(this.storageKey,"-code-verifier"));case 20:return this._notifyAllSubscribers("SIGNED_OUT",null),t.abrupt("return",{error:null});case 22:case"end":return t.stop()}}),t,this)})))}},{key:"onAuthStateChange",value:function(e){var t=this,r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),n={id:r,callback:e,unsubscribe:function(){t.stateChangeEmitters.delete(r)}};return this.stateChangeEmitters.set(r,n),this.emitInitialSession(r),{data:{subscription:n}}}},{key:"emitInitialSession",value:function(e){var t,r;return St(this,void 0,void 0,(0,n.Z)().mark((function s(){var i,a,o;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.getSession();case 3:if(i=n.sent,a=i.data.session,!(o=i.error)){n.next=8;break}throw o;case 8:null===(t=this.stateChangeEmitters.get(e))||void 0===t||t.callback("INITIAL_SESSION",a),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(0),null===(r=this.stateChangeEmitters.get(e))||void 0===r||r.callback("INITIAL_SESSION",null),console.error(n.t0);case 15:case"end":return n.stop()}}),s,this,[[0,11]])})))}},{key:"resetPasswordForEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return St(this,void 0,void 0,(0,n.Z)().mark((function r(){var s,i,a;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=null,i=null,"pkce"!==this.flowType){r.next=10;break}return a=Ve(),r.next=6,Fe(this.storage,"".concat(this.storageKey,"-code-verifier"),a);case 6:return r.next=8,$e(a);case 8:s=r.sent,i=a===s?"plain":"s256";case 10:return r.prev=10,r.next=13,vt(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo});case 13:return r.abrupt("return",r.sent);case 16:if(r.prev=16,r.t0=r.catch(10),!Ye(r.t0)){r.next=20;break}return r.abrupt("return",{data:null,error:r.t0});case 20:throw r.t0;case 21:case"end":return r.stop()}}),r,this,[[10,16]])})))}},{key:"_refreshAccessToken",value:function(e){return St(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s=this;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=Date.now(),t.next=4,Ke((function(t){return St(s,void 0,void 0,(0,n.Z)().mark((function r(){return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Ge(200*t);case 2:return r.next=4,vt(this.fetch,"POST","".concat(this.url,"/token?grant_type=refresh_token"),{body:{refresh_token:e},headers:this.headers,xform:bt});case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}}),r,this)})))}),(function(e,t,n){return n&&n.error&&n.error instanceof ct&&Date.now()+200*(e+1)-r<Et}));case 4:return t.abrupt("return",t.sent);case 7:if(t.prev=7,t.t0=t.catch(0),!Ye(t.t0)){t.next=11;break}return t.abrupt("return",{data:{session:null,user:null},error:t.t0});case 11:throw t.t0;case 12:case"end":return t.stop()}}),t,null,[[0,7]])})))}},{key:"_isValidSession",value:function(e){return"object"===typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}},{key:"_handleProviderSignIn",value:function(e,t){return St(this,void 0,void 0,(0,n.Z)().mark((function r(){var s;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});case 2:return s=r.sent,Ue()&&!t.skipBrowserRedirect&&window.location.assign(s),r.abrupt("return",{data:{provider:e,url:s},error:null});case 5:case"end":return r.stop()}}),r,this)})))}},{key:"_recoverAndRefresh",value:function(){var e;return St(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i,a;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Me(this.storage,this.storageKey);case 3:if(r=t.sent,this._isValidSession(r)){t.next=9;break}if(null===r){t.next=8;break}return t.next=8,this._removeSession();case 8:return t.abrupt("return");case 9:if(s=Math.round(Date.now()/1e3),!((null!==(e=r.expires_at)&&void 0!==e?e:1/0)<s+10)){t.next=22;break}if(!this.autoRefreshToken||!r.refresh_token){t.next=20;break}return t.next=14,this._callRefreshToken(r.refresh_token);case 14:if(i=t.sent,!(a=i.error)){t.next=20;break}return console.log(a.message),t.next=20,this._removeSession();case 20:t.next=26;break;case 22:if(!this.persistSession){t.next=25;break}return t.next=25,this._saveSession(r);case 25:this._notifyAllSubscribers("SIGNED_IN",r);case 26:t.next=32;break;case 28:return t.prev=28,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return");case 32:case"end":return t.stop()}}),t,this,[[0,28]])})))}},{key:"_callRefreshToken",value:function(e){var t,r;return St(this,void 0,void 0,(0,n.Z)().mark((function s(){var i,a,o,c,u;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.refreshingDeferred){n.next=2;break}return n.abrupt("return",this.refreshingDeferred.promise);case 2:if(n.prev=2,this.refreshingDeferred=new He,e){n.next=6;break}throw new nt;case 6:return n.next=8,this._refreshAccessToken(e);case 8:if(i=n.sent,a=i.data,!(o=i.error)){n.next=13;break}throw o;case 13:if(a.session){n.next=15;break}throw new nt;case 15:return n.next=17,this._saveSession(a.session);case 17:return this._notifyAllSubscribers("TOKEN_REFRESHED",a.session),c={session:a.session,error:null},this.refreshingDeferred.resolve(c),n.abrupt("return",c);case 23:if(n.prev=23,n.t0=n.catch(2),!Ye(n.t0)){n.next=29;break}return u={session:null,error:n.t0},null===(t=this.refreshingDeferred)||void 0===t||t.resolve(u),n.abrupt("return",u);case 29:throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(n.t0),n.t0;case 31:return n.prev=31,this.refreshingDeferred=null,n.finish(31);case 34:case"end":return n.stop()}}),s,this,[[2,23,31,34]])})))}},{key:"_notifyAllSubscribers",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t}),this.stateChangeEmitters.forEach((function(r){return r.callback(e,t)}))}},{key:"_saveSession",value:function(e){return St(this,void 0,void 0,(0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.persistSession||(this.inMemorySession=e),!this.persistSession||!e.expires_at){t.next=4;break}return t.next=4,this._persistSession(e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"_persistSession",value:function(e){return Fe(this.storage,this.storageKey,e)}},{key:"_removeSession",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.persistSession){e.next=5;break}return e.next=3,Je(this.storage,this.storageKey);case 3:e.next=6;break;case 5:this.inMemorySession=null;case 6:case"end":return e.stop()}}),e,this)})))}},{key:"_removeVisibilityChangedCallback",value:function(){var e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ue()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}},{key:"_startAutoRefresh",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){var t,r=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._stopAutoRefresh();case 2:return t=setInterval((function(){return r._autoRefreshTokenTick()}),Et),this.autoRefreshTicker=t,t&&"object"===typeof t&&"function"===typeof t.unref?t.unref():"undefined"!==typeof Deno&&"function"===typeof Deno.unrefTimer&&Deno.unrefTimer(t),e.next=7,this._autoRefreshTokenTick();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"_stopAutoRefresh",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){var t;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.autoRefreshTicker,this.autoRefreshTicker=null,t&&clearInterval(t);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"startAutoRefresh",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._removeVisibilityChangedCallback(),e.next=3,this._startAutoRefresh();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"stopAutoRefresh",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._removeVisibilityChangedCallback(),e.next=3,this._stopAutoRefresh();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"_autoRefreshTokenTick",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){var t,r,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Date.now(),e.prev=1,e.next=4,this.getSession();case 4:if(r=e.sent,(s=r.data.session)&&s.refresh_token&&s.expires_at){e.next=8;break}return e.abrupt("return");case 8:if(!(Math.floor((1e3*s.expires_at-t)/Et)<3)){e.next=12;break}return e.next=12,this._callRefreshToken(s.refresh_token);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),console.error("Auto refresh tick failed with error. This is likely a transient error.",e.t0);case 17:case"end":return e.stop()}}),e,this,[[1,14]])})))}},{key:"_handleVisibilityChange",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){var t=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ue()&&(null===window||void 0===window?void 0:window.addEventListener)){e.next=3;break}return this.autoRefreshToken&&this.startAutoRefresh(),e.abrupt("return",!1);case 3:return e.prev=3,this.visibilityChangedCallback=function(){return St(t,void 0,void 0,(0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._onVisibilityChanged(!1);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))},null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),e.next=8,this._onVisibilityChanged(!0);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("_handleVisibilityChange",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})))}},{key:"_onVisibilityChanged",value:function(e){return St(this,void 0,void 0,(0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("visible"!==document.visibilityState){t.next=9;break}if(e){t.next=6;break}return t.next=4,this.initializePromise;case 4:return t.next=6,this._recoverAndRefresh();case 6:this.autoRefreshToken&&this._startAutoRefresh(),t.next=10;break;case 9:"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh();case 10:case"end":return t.stop()}}),t,this)})))}},{key:"_getUrlForProvider",value:function(e,t){return St(this,void 0,void 0,(0,n.Z)().mark((function r(){var s,i,a,o,c,u;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=["provider=".concat(encodeURIComponent(e))],(null===t||void 0===t?void 0:t.redirectTo)&&s.push("redirect_to=".concat(encodeURIComponent(t.redirectTo))),(null===t||void 0===t?void 0:t.scopes)&&s.push("scopes=".concat(encodeURIComponent(t.scopes))),"pkce"!==this.flowType){r.next=13;break}return i=Ve(),r.next=7,Fe(this.storage,"".concat(this.storageKey,"-code-verifier"),i);case 7:return r.next=9,$e(i);case 9:a=r.sent,o=i===a?"plain":"s256",c=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(a)),code_challenge_method:"".concat(encodeURIComponent(o))}),s.push(c.toString());case 13:return(null===t||void 0===t?void 0:t.queryParams)&&(u=new URLSearchParams(t.queryParams),s.push(u.toString())),r.abrupt("return","".concat(this.url,"/authorize?").concat(s.join("&")));case 15:case"end":return r.stop()}}),r,this)})))}},{key:"_unenroll",value:function(e){var t;return St(this,void 0,void 0,(0,n.Z)().mark((function r(){var s,i,a;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.getSession();case 3:if(s=r.sent,i=s.data,!(a=s.error)){r.next=8;break}return r.abrupt("return",{data:null,error:a});case 8:return r.next=10,vt(this.fetch,"DELETE","".concat(this.url,"/factors/").concat(e.factorId),{headers:this.headers,jwt:null===(t=null===i||void 0===i?void 0:i.session)||void 0===t?void 0:t.access_token});case 10:return r.abrupt("return",r.sent);case 13:if(r.prev=13,r.t0=r.catch(0),!Ye(r.t0)){r.next=17;break}return r.abrupt("return",{data:null,error:r.t0});case 17:throw r.t0;case 18:case"end":return r.stop()}}),r,this,[[0,13]])})))}},{key:"_enroll",value:function(e){var t,r;return St(this,void 0,void 0,(0,n.Z)().mark((function s(){var i,a,o,c,u,h;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.getSession();case 3:if(i=n.sent,a=i.data,!(o=i.error)){n.next=8;break}return n.abrupt("return",{data:null,error:o});case 8:return n.next=10,vt(this.fetch,"POST","".concat(this.url,"/factors"),{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:null===(t=null===a||void 0===a?void 0:a.session)||void 0===t?void 0:t.access_token});case 10:if(c=n.sent,u=c.data,!(h=c.error)){n.next=15;break}return n.abrupt("return",{data:null,error:h});case 15:return(null===(r=null===u||void 0===u?void 0:u.totp)||void 0===r?void 0:r.qr_code)&&(u.totp.qr_code="data:image/svg+xml;utf-8,".concat(u.totp.qr_code)),n.abrupt("return",{data:u,error:null});case 19:if(n.prev=19,n.t0=n.catch(0),!Ye(n.t0)){n.next=23;break}return n.abrupt("return",{data:null,error:n.t0});case 23:throw n.t0;case 24:case"end":return n.stop()}}),s,this,[[0,19]])})))}},{key:"_verify",value:function(e){var t;return St(this,void 0,void 0,(0,n.Z)().mark((function r(){var s,i,a,o,c,u;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.getSession();case 3:if(s=r.sent,i=s.data,!(a=s.error)){r.next=8;break}return r.abrupt("return",{data:null,error:a});case 8:return r.next=10,vt(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/verify"),{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(t=null===i||void 0===i?void 0:i.session)||void 0===t?void 0:t.access_token});case 10:if(o=r.sent,c=o.data,!(u=o.error)){r.next=15;break}return r.abrupt("return",{data:null,error:u});case 15:return r.next=17,this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c));case 17:return this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),r.abrupt("return",{data:c,error:u});case 21:if(r.prev=21,r.t0=r.catch(0),!Ye(r.t0)){r.next=25;break}return r.abrupt("return",{data:null,error:r.t0});case 25:throw r.t0;case 26:case"end":return r.stop()}}),r,this,[[0,21]])})))}},{key:"_challenge",value:function(e){var t;return St(this,void 0,void 0,(0,n.Z)().mark((function r(){var s,i,a;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.getSession();case 3:if(s=r.sent,i=s.data,!(a=s.error)){r.next=8;break}return r.abrupt("return",{data:null,error:a});case 8:return r.next=10,vt(this.fetch,"POST","".concat(this.url,"/factors/").concat(e.factorId,"/challenge"),{headers:this.headers,jwt:null===(t=null===i||void 0===i?void 0:i.session)||void 0===t?void 0:t.access_token});case 10:return r.abrupt("return",r.sent);case 13:if(r.prev=13,r.t0=r.catch(0),!Ye(r.t0)){r.next=17;break}return r.abrupt("return",{data:null,error:r.t0});case 17:throw r.t0;case 18:case"end":return r.stop()}}),r,this,[[0,13]])})))}},{key:"_challengeAndVerify",value:function(e){return St(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,s,i;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._challenge({factorId:e.factorId});case 2:if(r=t.sent,s=r.data,!(i=r.error)){t.next=7;break}return t.abrupt("return",{data:null,error:i});case 7:return t.next=9,this._verify({factorId:e.factorId,challengeId:s.id,code:e.code});case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t,this)})))}},{key:"_listFactors",value:function(){return St(this,void 0,void 0,(0,n.Z)().mark((function e(){var t,r,s,i,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUser();case 2:if(t=e.sent,r=t.data.user,!(s=t.error)){e.next=7;break}return e.abrupt("return",{data:null,error:s});case 7:return i=(null===r||void 0===r?void 0:r.factors)||[],a=i.filter((function(e){return"totp"===e.factor_type&&"verified"===e.status})),e.abrupt("return",{data:{all:i,totp:a},error:null});case 10:case"end":return e.stop()}}),e,this)})))}},{key:"_getAuthenticatorAssuranceLevel",value:function(){var e,t;return St(this,void 0,void 0,(0,n.Z)().mark((function r(){var s,i,a,o,c,u,h;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.getSession();case 2:if(s=r.sent,i=s.data.session,!(a=s.error)){r.next=7;break}return r.abrupt("return",{data:null,error:a});case 7:if(i){r.next=9;break}return r.abrupt("return",{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null});case 9:return o=this._decodeJWT(i.access_token),c=null,o.aal&&(c=o.aal),u=c,(null!==(t=null===(e=i.user.factors)||void 0===e?void 0:e.filter((function(e){return"verified"===e.status})))&&void 0!==t?t:[]).length>0&&(u="aal2"),h=o.amr||[],r.abrupt("return",{data:{currentLevel:c,nextLevel:u,currentAuthenticationMethods:h},error:null});case 17:case"end":return r.stop()}}),r,this)})))}}]),e}(),Pt=function(e){(0,c.Z)(r,e);var t=(0,u.Z)(r);function r(e){return(0,s.Z)(this,r),t.call(this,e)}return(0,i.Z)(r)}(jt),At=function(e,t,r,n){return new(r||(r=Promise))((function(s,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function o(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},Ct={headers:Pe},Rt={schema:"public"},It={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ut={},Dt=function(){function e(t,r,n){var i,a,o,c,u,h,l,d;if((0,s.Z)(this,e),this.supabaseUrl=t,this.supabaseKey=r,!t)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");var f=t.replace(/\/$/,"");this.realtimeUrl="".concat(f,"/realtime/v1").replace(/^http/i,"ws"),this.authUrl="".concat(f,"/auth/v1"),this.storageUrl="".concat(f,"/storage/v1"),this.functionsUrl="".concat(f,"/functions/v1");var v="sb-".concat(new URL(this.authUrl).hostname.split(".")[0],"-auth-token"),p=function(e,t){var r=e.db,n=e.auth,s=e.realtime,i=e.global,a=t.db,o=t.auth,c=t.realtime,u=t.global;return{db:Object.assign(Object.assign({},a),r),auth:Object.assign(Object.assign({},o),n),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},u),i)}}(null!==n&&void 0!==n?n:{},{db:Rt,realtime:Ut,auth:Object.assign(Object.assign({},It),{storageKey:v}),global:Ct});this.storageKey=null!==(a=null===(i=p.auth)||void 0===i?void 0:i.storageKey)&&void 0!==a?a:"",this.headers=null!==(c=null===(o=p.global)||void 0===o?void 0:o.headers)&&void 0!==c?c:{},this.auth=this._initSupabaseAuthClient(null!==(u=p.auth)&&void 0!==u?u:{},this.headers,null===(h=p.global)||void 0===h?void 0:h.fetch),this.fetch=Re(r,this._getAccessToken.bind(this),null===(l=p.global)||void 0===l?void 0:l.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},p.realtime)),this.rest=new U("".concat(f,"/rest/v1"),{headers:this.headers,schema:null===(d=p.db)||void 0===d?void 0:d.schema,fetch:this.fetch}),this._listenForAuthEvents()}return(0,i.Z)(e,[{key:"functions",get:function(){return new Z(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}},{key:"storage",get:function(){return new je(this.storageUrl,this.headers,this.fetch)}},{key:"from",value:function(e){return this.rest.from(e)}},{key:"rpc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return this.rest.rpc(e,t,r)}},{key:"channel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(e,t)}},{key:"getChannels",value:function(){return this.realtime.getChannels()}},{key:"removeChannel",value:function(e){return this.realtime.removeChannel(e)}},{key:"removeAllChannels",value:function(){return this.realtime.removeAllChannels()}},{key:"_getAccessToken",value:function(){var e,t;return At(this,void 0,void 0,(0,n.Z)().mark((function r(){var s,i;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.auth.getSession();case 2:return s=r.sent,i=s.data,r.abrupt("return",null!==(t=null===(e=i.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null);case 5:case"end":return r.stop()}}),r,this)})))}},{key:"_initSupabaseAuthClient",value:function(e,t,r){var n=e.autoRefreshToken,s=e.persistSession,i=e.detectSessionInUrl,a=e.storage,o=e.storageKey,c=e.flowType,u={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new Pt({url:this.authUrl,headers:Object.assign(Object.assign({},u),t),storageKey:o,autoRefreshToken:n,persistSession:s,detectSessionInUrl:i,storage:a,flowType:c,fetch:r})}},{key:"_initRealtimeClient",value:function(e){return new ae(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null===e||void 0===e?void 0:e.params)}))}},{key:"_listenForAuthEvents",value:function(){var e=this;return this.auth.onAuthStateChange((function(t,r){e._handleTokenChanged(t,null===r||void 0===r?void 0:r.access_token,"CLIENT")}))}},{key:"_handleTokenChanged",value:function(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===t?"SIGNED_OUT"===e&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==r&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!==t&&void 0!==t?t:null),this.changedAccessToken=t)}}]),e}(),Nt=function(e,t,r){return new Dt(e,t,r)}},4255:function(e,t){var r="undefined"!==typeof self?self:this,n=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException}return e.prototype=r,new e}();!function(e){!function(t){var r="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,s="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,a="ArrayBuffer"in e;if(a)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!==typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function h(e){return"string"!==typeof e&&(e=String(e)),e}function l(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function f(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function v(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function p(e){var t=new FileReader,r=v(t);return t.readAsArrayBuffer(e),r}function b(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function y(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"===typeof e?this._bodyText=e:s&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():a&&s&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=b(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a&&(ArrayBuffer.prototype.isPrototypeOf(e)||c(e))?this._bodyArrayBuffer=b(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"===typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s&&(this.blob=function(){var e=f(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(p)}),this.text=function(){var e=f(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,r=v(t);return t.readAsText(e),r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(g)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=u(e),t=h(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},d.prototype.delete=function(e){delete this.map[u(e)]},d.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},d.prototype.set=function(e,t){this.map[u(e)]=h(t)},d.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),l(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),l(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),l(e)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function k(e,t){var r=(t=t||{}).body;if(e instanceof k){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=function(e){var t=e.toUpperCase();return m.indexOf(t)>-1?t:e}(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function g(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(s))}})),t}function w(e){var t=new d;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var s=r.join(":").trim();t.append(n,s)}})),t}function x(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}k.prototype.clone=function(){return new k(this,{body:this._bodyInit})},y.call(k.prototype),y.call(x.prototype),x.prototype.clone=function(){return new x(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},x.error=function(){var e=new x(null,{status:0,statusText:""});return e.type="error",e};var _=[301,302,303,307,308];x.redirect=function(e,t){if(-1===_.indexOf(t))throw new RangeError("Invalid status code");return new x(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(T){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function Z(e,r){return new Promise((function(n,i){var a=new k(e,r);if(a.signal&&a.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var o=new XMLHttpRequest;function c(){o.abort()}o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:w(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;n(new x(t,e))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},o.open(a.method,a.url,!0),"include"===a.credentials?o.withCredentials=!0:"omit"===a.credentials&&(o.withCredentials=!1),"responseType"in o&&s&&(o.responseType="blob"),a.headers.forEach((function(e,t){o.setRequestHeader(t,e)})),a.signal&&(a.signal.addEventListener("abort",c),o.onreadystatechange=function(){4===o.readyState&&a.signal.removeEventListener("abort",c)}),o.send("undefined"===typeof a._bodyInit?null:a._bodyInit)}))}Z.polyfill=!0,e.fetch||(e.fetch=Z,e.Headers=d,e.Request=k,e.Response=x),t.Headers=d,t.Request=k,t.Response=x,t.fetch=Z,Object.defineProperty(t,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var s=n;(t=s.fetch).default=s.fetch,t.fetch=s.fetch,t.Headers=s.Headers,t.Request=s.Request,t.Response=s.Response,e.exports=t},4210:function(e){var t=function(){if("object"===typeof self&&self)return self;if("object"===typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};e.exports=function(){if(this)return this;if("object"===typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return t()}try{return __global__||t()}finally{delete Object.prototype.__global__}}()},5087:function(e,t,r){var n;if("object"===typeof globalThis)n=globalThis;else try{n=r(4210)}catch(o){}finally{if(n||"undefined"===typeof window||(n=window),!n)throw new Error("Could not determine global this")}var s=n.WebSocket||n.MozWebSocket,i=r(1496);function a(e,t){return t?new s(e,t):new s(e)}s&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(e){Object.defineProperty(a,e,{get:function(){return s[e]}})})),e.exports={w3cwebsocket:s?a:null,version:i}},1496:function(e,t,r){e.exports=r(9794).version},9794:function(e){"use strict";e.exports={version:"1.0.34"}}}]);
//# sourceMappingURL=90.5480d177.chunk.js.map